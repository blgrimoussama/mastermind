(function(){var e="";function t(){n(element.navigation,function(){Pe.back()});n(element.menuButtonLogin,function(){e="";Message.addTop(element.loginBox,null,true)});n(element.menuButtonProfile,function(){Pe.gotoProfile()});n(element.menuButtonFindOpponent,function(){Pe.gotoFindOpponent()});n(element.menuButtonInviteFriend,function(){Pe.gotoInviteFriend()});n(element.menuButtonLocalMultiplayer,function(){Pe.gotoGameLocalMultiplayer()});n(element.menuButtonPlayAgainstAi,function(){Message.addTop(element.aiBox,null,true)});n(element.menuButtonMore,function(){Pe.gotoMore()});n(element.menuButtonMoreGames,function(){q("more games");window.open("http://iogames.space")});n(element.menuButtonInviteFriendsFacebook,function(){inviteFriendsFacebook()});n(element.aiDifficultyEasy,function(){Se.aiDifficulty="easy";Pe.gotoGameLocalAI();Message.remove()});n(element.aiDifficultyMedium,function(){Se.aiDifficulty="medium";Pe.gotoGameLocalAI();Message.remove()});n(element.aiDifficultyHard,function(){Se.aiDifficulty="hard";Pe.gotoGameLocalAI();Message.remove()});n(element.findOpponentTitleLink,function(){N(element.findOpponentTitleLink)});n(element.findOpponentInviteFriendButton,function(){Pe.gotoInviteFriend()});n(element.findOpponentFindOpponentButton,function(){Pe.reset();Pe.gotoFindOpponent()});n(element.findOpponentTryAgainButton,function(){Pe.reload()});n(element.changeDifficulty,function(){Message.remove();Message.addTop(element.aiBox,null,true)});n(element.cloudTitleYou,function(){Y(element.cloudTitleYou)});n(element.cloudTitleOpponent,function(){Y(element.cloudTitleOpponent)});n(element.shareLinkArea,function(){N(element.shareLinkArea)});n(element.inviteGoButton,function(){Pe.gotoFindOpponentChannel()});n(element.aboutToPlayChannel,function(){N(element.shareLinkArea)});n(element.invitedGoButton,function(){Pe.gotoFindOpponentChannelInvited()});n(element.messageBoxBackground,function(){Message.remove()});n(element.rematchTitle,function(){Y(element.rematchTitle)});n(element.playAgainButton,function(){Pe.playAgain();Message.remove()});n(element.playAgainFindOpponentButton,function(){Pe.gotoFindOpponent();Message.remove()});n(element.rematchButton,function(){Pe.rematch()});n(element.exitToMenuButton,function(){Message.remove();Pe.back()});n(element.leaveButton,function(){Message.remove();Pe.leave()});n(element.keepPlayingButton,function(){Message.remove()});n(element.errorOkButton,function(){Message.remove()});n(element.embedOkButton,function(){Message.remove()});n(element.embed,function(){Message.addTop(element.embedBox,null,true)});n(element.toggleLog,function(){S()});n(element.promoteFacebook,function(){q("facebook");window.open("https://www.facebook.com/c4arena","_blank")});n(element.promoteChrome,function(){q("chrome");window.open("https://chrome.google.com/webstore/detail/c4arena/fdjcaibkhkgbkhpolfgbbmgdpoblapko")});n(element.promoteChromeRating,function(){q("chrome rating");window.open("https://chrome.google.com/webstore/detail/c4arena/fdjcaibkhkgbkhpolfgbbmgdpoblapko")});n(element.askBuyIconYes,function(){Message.remove();document.body.classList.add("processing-visible");c.post("/api/buy-icon/"+Me,null,Oe)});n(element.askBuyIconNo,function(){Message.remove()});n(element.buyMoreGold,function(){Message.remove();Pe.gotoBuyGold()});n(element.profileButtonChangeIcon,function(){Pe.gotoIcons()});n(element.profileButtonBuyIcons,function(){Pe.gotoIcons()});n(element.profileButtonBuyGold,function(){Pe.gotoBuyGold()});n(element.profileButtonLogout,function(){window.top.location.href="/logout"});n(element.profileButtonChest,function(){g()});n(element.chestOpenImg,function(){y()});n(element.adMainChest,function(){g()});n(element.promoteRegister200x200,function(){e="";Message.addTop(element.loginBox,null,true)});n(element.promoteRegister496x150,function(){e="";Message.addTop(element.loginBox,null,true)});n(element.promoteBuyGold200x200,function(){if(typeof serverData.user!=="undefined"){Pe.gotoBuyGold()}else{Message.addTop(element.buyGoldLoginRequiredBox,null,true)}});n(element.promoteBuyGold496x150,function(){if(typeof serverData.user!=="undefined"){Pe.gotoBuyGold()}else{Message.addTop(element.buyGoldLoginRequiredBox,null,true)}});n(element.promoteBuyIcons200x200,function(){if(typeof serverData.user!=="undefined"){Pe.gotoIcons()}else{Message.addTop(element.buyIconsLoginRequiredBox,null,true)}});n(element.promoteBuyIcons496x150,function(){if(typeof serverData.user!=="undefined"){Pe.gotoIcons()}else{Message.addTop(element.buyIconsLoginRequiredBox,null,true)}});n(element.chestLogin,function(){e="";Message.remove();Message.addTop(element.loginBox,null,true)});n(element.buyGoldLogin,function(){e="screenBuyGold";Message.remove();Message.addTop(element.loginBox,null,true)});n(element.buyIconsLogin,function(){e="screenIcons";Message.remove();Message.addTop(element.loginBox,null,true)});n(element.loginGoogle,function(){var t="/auth/gplus";if(e!==""){t+="/goto/"+e}window.top.location.href=t});n(element.loginFacebook,function(){var t="/auth/facebook";if(e!==""){t+="/goto/"+e}window.top.location.href=t});var t=document.getElementsByClassName("message-box-content");for(var i=0;i<t.length;++i){var o=document.createElement("div");o.classList.add("close");o.innerHTML=Fontello.get("cancel");t[i].appendChild(o);n(o,function(){Message.remove()})}var s=document.getElementsByClassName("close-button");for(var i=0;i<s.length;++i){n(s[i],function(){Message.remove()})}n(element.buyGold200,function(){u("c4arena-200-gold")});n(element.buyGold600,function(){u("c4arena-600-gold")});n(element.buyGold1300,function(){u("c4arena-1300-gold")});n(element.buyGold2100,function(){u("c4arena-2100-gold")});n(element.buyGold3000,function(){u("c4arena-3000-gold")})}function n(e,t){if(typeof e==="undefined"||e===null||typeof t==="undefined"||t===null){return}e.addEventListener("click",t)}var i={};var o={_300x250:"<iframe  src='//ads.ad4game.com/www/delivery/afr.php?zoneid=62984' framespacing='0' frameborder='no' scrolling='no' width='300' height='250'><a href='//ads.ad4game.com/www/delivery/dck.php?n=ad994c63' target='_blank'><img src='//ads.ad4game.com/www/delivery/avw.php?zoneid=62984&amp;n=ad994c63' border='0' alt='' /></a></iframe>",_728x90:"<iframe  src='//ads.ad4game.com/www/delivery/afr.php?zoneid=62985' framespacing='0' frameborder='no' scrolling='no' width='728' height='90'><a href='//ads.ad4game.com/www/delivery/dck.php?n=a811d83b' target='_blank'><img src='//ads.ad4game.com/www/delivery/avw.php?zoneid=62985&amp;n=a811d83b' border='0' alt='' /></a></iframe>",_160x600:"<iframe  src='//ads.ad4game.com/www/delivery/afr.php?zoneid=62983' framespacing='0' frameborder='no' scrolling='no' width='160' height='600'><a href='//ads.ad4game.com/www/delivery/dck.php?n=a20f18f6' target='_blank'><img src='//ads.ad4game.com/www/delivery/avw.php?zoneid=62983&amp;n=a20f18f6' border='0' alt='' /></a></iframe>"};var s={_300x250:"<iframe  src='https://c4arena-utils.netlify.app/300x250.html' allowtransparency='true' framespacing='0' frameborder='no' scrolling='no' width='300' height='250'></iframe>",_728x90:"<iframe  src='"+window.location.origin+"/a/cpmstar/728x90.html'  allowtransparency='true' framespacing='0' frameborder='no' scrolling='no' width='728' height='90'></iframe>",_160x600:"<iframe  src='"+window.location.origin+"/a/cpmstar/160x600.html' allowtransparency='true' framespacing='0' frameborder='no' scrolling='no' width='160' height='600'></iframe>",_300x600:"<iframe  src='"+window.location.origin+"/a/cpmstar/300x600.html' allowtransparency='true' framespacing='0' frameborder='no' scrolling='no' width='300' height='600'></iframe>",_300x50:"<iframe  src='"+window.location.origin+"/a/cpmstar/300x50.html'  allowtransparency='true' framespacing='0' frameborder='no' scrolling='no' width='300' height='50'></iframe>"};a([i,o,s]);function a(e){var t=[];for(var n=0;n<e.length;n++){for(var i in e[n]){t.push(i)}}for(var n=0;n<e.length;n++){for(var o=0;o<t.length;o++){if(typeof e[n][t[o]]==="undefined"){e[n][t[o]]=""}}}}var r=s;function l(e){d=e;if(typeof gdsdk!=="undefined"&&gdsdk.showBanner!=="undefined"){document.getElementById("resize-fixer").style.display="none";gdsdk.showBanner()}else{if(typeof e!=="undefined"){e()}}}var d;if(document.location.search.search("gd_sdk_referrer_url")!==-1){window["GD_OPTIONS"]={gameId:"02c58ca319eb4e878fd914bed5ba6655",onEvent:function(e){switch(e.name){case"SDK_GAME_START":if(typeof d!=="undefined"){document.getElementById("resize-fixer").style.display="block";d();d=undefined}break;case"SDK_GAME_PAUSE":break;case"SDK_GDPR_TRACKING":break;case"SDK_GDPR_TARGETING":break}}};(function(e,t,n){var i,o=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;i=e.createElement(t);i.id=n;i.src="https://html5.api.gamedistribution.com/main.min.js";o.parentNode.insertBefore(i,o)})(document,"script","gamedistribution-jssdk")}var c={};c.x=function(){if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}var e=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];var t;for(var n=0;n<e.length;n++){try{t=new ActiveXObject(e[n]);break}catch(e){}}return t};c.send=function(e,t,n,i,o){if(o===undefined){o=true}var s=c.x();s.open(n,e,o);s.onreadystatechange=function(){if(s.readyState==4){t(s.responseText)}};if(n==="POST"){s.setRequestHeader("Content-type","application/x-www-form-urlencoded")}s.send(i)};c.get=function(e,t,n,i){var o=[];for(var s in t){o.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]))}c.send(e+(o.length?"?"+o.join("&"):""),n,"GET",null,i)};c.post=function(e,t,n,i){var o=[];for(var s in t){o.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]))}c.send(e,n,"POST",o.join("&"),i)};function m(){c.post("/api/get-gold",null,function(e){console.log("a");var t=JSON.parse(e);if(typeof t.success!=="undefined"&&t.success===true){console.log("b",t.gold);console.log(Ae);Ae(t.gold)}else{Message.addTop(element.errorBox,function(){element.errorTitle.innerHTML="Error:<br>Can't get amount of your gold. Try refreshing page in few minutes.";console.log("c")},true)}})}function u(e){element.buyGoldButtonGroup.classList.add("buy-gold-inactive");c.post("/api/get-buying-enabled",null,function(t){var n=JSON.parse(t);element.buyGoldButtonGroup.classList.remove("buy-gold-inactive");if(typeof n.value!=="undefined"&&n.value===true){fastspring.builder.reset();if(typeof serverData.user!=="undefined"){fastspring.builder.tag("userID",he.id)}fastspring.builder.add(e);fastspring.builder.checkout()}else{Message.addTop(element.errorBox,function(){element.errorTitle.innerHTML="Error:<br>Can't reach server. Try again later."},true)}})}window.popupClosedCallback=function(e){if(e.id!==null){m()}};function h(){if(typeof serverData.user==="undefined"){element.adMainChestReady.classList.remove("hide");element.adMainChestLocked.classList.add("hide");return}var e=setInterval(function(){if(p()===true){element.profileChestText.innerHTML="Open chest";element.chestReady.classList.remove("hide");element.chestLocked.classList.add("hide");element.adMainChestReady.classList.remove("hide");element.adMainChestLocked.classList.add("hide");return}element.chestReady.classList.add("hide");element.chestLocked.classList.remove("hide");element.adMainChestReady.classList.add("hide");element.adMainChestLocked.classList.remove("hide");var e=(new Date).getTime();var t=f().getTime()+deltaTime;var n=t-e;var i=Math.floor(n/(1e3*60*60*24));var o=Math.floor(n%(1e3*60*60*24)/(1e3*60*60));var s=Math.floor(n%(1e3*60*60)/(1e3*60));var a=Math.floor(n%(1e3*60)/1e3);var r=_(o+i*24);var l=_(s);var d=_(a);timeString=r+":"+l+":"+d;element.profileChestText.innerHTML=timeString;for(var c=0;c<element.chestTime.length;++c){element.chestTime[c].innerHTML=timeString}},1e3)}function p(){var e=new Date(he.chestOpenDate);var t=new Date(Date.now()-deltaTime);var n=e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();if(e===""||n===false){return true}else{return false}}function f(){var e=new Date;e.setDate(e.getDate()+1);e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);return e}function g(){element.chestNotOpen.classList.remove("hide");element.chestSuccess.classList.add("hide");element.chestError.classList.add("hide");element.chestOpenImg.classList.remove("chest-opening");if(typeof serverData.user==="undefined"){Message.addTop(element.chestLoginRequiredBox,null,true)}else{Message.addTop(element.chestBox,null,true)}}function y(){element.chestOpenImg.classList.add("chest-opening");c.post("/api/open-chest",null,v)}function v(e){var t=JSON.parse(e);element.chestNotOpen.classList.add("hide");if(typeof t.success!=="undefined"&&t.success===true){he.chestOpenDate=t.time;Ae(he.gold+t.gold);element.chestSuccess.classList.remove("hide");element.chestObtainedGold.innerHTML=t.gold;element.chestCoin.innerHTML=t.gold;element.chestCoin.classList.add("chest-coin-anim")}else{element.chestErrorContent.innerHTML="Error:<br>"+t.error;element.chestError.classList.remove("hide")}E()}var b;var I=false;function L(){clearTimeout(b);b=setTimeout(resize,10)}resize=function(){T();w();M();E();D();B();O();if(Pe.currentScreen===Pe.screenGame){if(element.screenGame.getBoundingClientRect().right>window.innerWidth-180){element.ingameAd.classList.add("hide")}else{element.ingameAd.classList.remove("hide")}if(window.innerWidth<728){element.ingameAd2.classList.add("hide")}else{element.ingameAd2.classList.remove("hide")}}};function w(){var e=ue.gameBoardWidth;var t=ue.gameBoardHeight;if(Pe.currentScreen===Pe.screenGame){element.gameBoardContainer.style.height=0;var n=ue.gameBoardWidth/ue.gameBoardHeight;var i=element.screenGame.offsetWidth;var o=window.innerHeight-element.screens.offsetHeight+element.gameBoardContainer.offsetHeight;if(I===false){o+=element.navigation.offsetHeight-1}o-=k();o=Math.min(Math.max(o,0),i/n);if(i/o>n){t=o;e=o*n}else{e=i;t=i/n}element.gameBoardContainer.style.height=t+"px";element.gameBoardContainer.style.width=e+"px";element.screenGame.style.padding="0 "+(element.screens.offsetWidth-e)/2+"px";var s=element.playerFieldOpponent.offsetWidth-element.smallDiscOpponent.offsetWidth;if(element.nameOpponent.offsetWidth>s){element.nameOpponent.style.webkitTransform="scale("+s/element.nameOpponent.offsetWidth+")";element.nameOpponent.style.msTransform="scale("+s/element.nameOpponent.offsetWidth+")";element.nameOpponent.style.transform="scale("+s/element.nameOpponent.offsetWidth+")"}else{element.nameOpponent.style.webkitTransform="scale(1)";element.nameOpponent.style.msTransform="scale(1)";element.nameOpponent.style.transform="scale(1)"}s=element.playerFieldYou.offsetWidth-element.smallDiscYou.offsetWidth;if(element.nameYou.offsetWidth>s){element.nameYou.style.webkitTransform="scale("+s/element.nameYou.offsetWidth+")";element.nameYou.style.msTransform="scale("+s/element.nameYou.offsetWidth+")";element.nameYou.style.transform="scale("+s/element.nameYou.offsetWidth+")"}else{element.nameYou.style.webkitTransform="scale(1)";element.nameYou.style.msTransform="scale(1)";element.nameYou.style.transform="scale(1)"}}else{element.screenGame.style.padding="0"}element.gameBoard.style.webkitTransform="scale("+e/ue.gameBoardWidth+", "+t/ue.gameBoardHeight+")";element.gameBoard.style.msTransform="scale("+e/ue.gameBoardWidth+", "+t/ue.gameBoardHeight+")";element.gameBoard.style.transform="scale("+e/ue.gameBoardWidth+", "+t/ue.gameBoardHeight+")"}function M(){var e=Math.floor((window.innerHeight-element.screens.offsetHeight-k()+navigation.offsetHeight+element.mainMenuTopAd.offsetHeight)/2);if(I===true){e=Math.max(C()+navigation.offsetHeight+element.mainMenuTopAd.offsetHeight,e)}else{e=Math.max(C(),e)}if(e>element.mainMenuTopAd.offsetHeight){element.screens.style.top=e+"px"}else{element.screens.style.top=element.mainMenuTopAd.offsetHeight+"px"}}function B(){element.socialBar.style.top=Math.max(window.innerHeight-element.socialBar.offsetHeight,element.screens.offsetTop+element.screens.offsetHeight)+"px"}function T(){if(Pe.currentScreen===Pe.screenGame&&element.screens.classList.contains("lock-width")===false){I=false;return}element.screens.style.top=0;element.gameBoardContainer.offsetLeft;var e=element.navigation.offsetHeight>0;I=e&&element.screens.offsetTop<element.navigation.offsetHeight&&element.screens.offsetLeft<element.navigation.offsetWidth}function k(){var e=0;var t=document.getElementsByClassName("height-exclude");for(var n=0;n<t.length;n++){e+=t[n].offsetHeight}return e-1}function C(){var e=0;var t=document.getElementsByClassName("height-exclude");for(var n=0;n<t.length;n++){if(element.content.offsetTop>=t[n].offsetTop+t[n].offsetHeight){e+=t[n].offsetHeight}}return e-1}function E(){element.messageBox.style.top=Math.max(0,window.innerHeight/2-element.messageBox.offsetHeight/2)+"px"}function D(){if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)){document.body.style.height=element.screens.offsetHeight+"px"}window.scrollTo(0,0)}function O(){var e=(-element.mainMenuAd.offsetHeight+window.innerHeight)/2-element.screens.getBoundingClientRect().top;e=Math.max(e,-element.screens.getBoundingClientRect().top);element.mainMenuAd.style.webkitTransform="translateY("+e+"px)";element.mainMenuAd.style.msTransform="translateY("+e+"px)";element.mainMenuAd.style.transform="translateY("+e+"px)"}function A(e){}function S(){element.logArea.classList.toggle("log-show");element.logArea.classList.toggle("log-hide")}function x(e){e.preventDefault()}function P(){var e=window.navigator.userAgent;var t=e.indexOf("MSIE");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)));else if(!!navigator.userAgent.match(/Trident\/7\./))return 11;else return 0}function H(e){for(var t=0;t<e.length;t++){var n=new Image;n.src=e[t]}}function F(e){e.select()}function G(e){if(e.startsWith(domain+"/")){e=e.replace(domain+"/","")}e=e.toLowerCase();e=e.replace(/[^a-z0-9\s\.-]/g,"");e=e.replace(/\s/g,"-");e=e.substring(0,25);if(e.length===1){e="-"+e}for(var t=0;t<be.length;t++){if(e===be[t]){e="-"+e;break}}return e}function N(e){e.setSelectionRange(0,9999)}function Y(e){e.classList.add("hide")}function R(){if(queryArray.length>0&&queryArray[0].length>1){for(var e=0;e<be.length;e++){if(queryArray[0]===be[e]){return false}}return true}else{return false}}function W(e){if(environment!=="home"){return}ga("send",{hitType:"event",eventCategory:"Ads",eventAction:"show",eventLabel:e,nonInteraction:true})}function q(e){ga("send","event",{eventCategory:"Outbound Link",eventAction:"click",eventLabel:e})}function z(e,t){var n=false;function i(){if(!n){n=true;e()}}setTimeout(i,t||1e3);return i}function j(){if(environment==="facebook"){return}if(typeof serverData.user==="undefined"){element.menuButtonLogin.classList.remove("hide");element.menuButtonProfile.classList.add("hide")}else{element.menuButtonLogin.classList.add("hide");element.menuButtonProfile.classList.remove("hide");element.promoteRegister496x150.parentElement.removeChild(element.promoteRegister496x150)}}function _(e){if(e<10){return"0"+e}else{return""+e}}function X(){if(environment==="kongregate"){return}element.gameEndAd.classList.remove("hide");if(window.innerHeight>=470){element.gameEndAd.innerHTML=r._300x250}else{element.gameEndAd.innerHTML=""}}function V(){if(environment==="kongregate"){return}element.mainMenuAd.classList.remove("hide");if(window.innerWidth>=600){if(window.innerHeight>=650){element.mainMenuAd.innerHTML=r._300x600}else{element.mainMenuAd.innerHTML=r._300x250}}}function U(){return;if(environment==="kongregate"){return}if(reloadIngameAdFlag===true){element.ingameAd.classList.remove("hide");element.ingameAd2.classList.remove("hide");if(window.innerWidth>=728){element.ingameAd2Content.innerHTML=r._728x90;element.ingameAd2.classList.add("ingame-add-2-appear")}}else{element.ingameAd2.classList.remove("ingame-add-2-appear")}Pe.screenGame.showAd=false}function J(){if(environment==="kongregate"){return}element.findOpponentAd.classList.remove("hide");element.findOpponentAd.innerHTML=r._300x250}function K(){var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true})(navigator.userAgent||navigator.vendor||window.opera);return e}function Q(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var Z=80;var $=300;var ee=0;var te;function ne(){clearTimeout(te);if(ee<$){xe.webSocket.send("poke");ee+=Z;A("-> Poke");te=setTimeout(ne,Z*1e3)}else{ee=0}}function ie(){ee=0;clearTimeout(te);te=setTimeout(ne,Z*1e3)}function oe(e){this.url=e;webSocket=null;lastMessage="";this.open=false;if(!window["WebSocket"]){A("Error: Your browser does not support web sockets")}}oe.prototype.connect=function(){if(this.open===true){return}var e=this;if(this.webSocket){this.close()}this.webSocket=new WebSocket(this.url);this.webSocket.onclose=function(t){e.open=false;A("["+t.code+"] Connection has been closed. "+t.reason);typeof Pe.currentScreen.onConnectionClose==="function"&&Pe.currentScreen.onConnectionClose(t)};this.webSocket.onerror=function(e){console.log(e);typeof Pe.currentScreen.onConnectionError==="function"&&Pe.currentScreen.onConnectionError(e)};this.webSocket.onopen=function(t){e.open=true;ie();typeof Pe.currentScreen.onConnectionOpen==="function"&&Pe.currentScreen.onConnectionOpen(t)};this.webSocket.onmessage=function(t){e.lastMessage=JSON.parse(t.data);if(e.lastMessage.hasOwnProperty("message")){A("<- "+e.lastMessage.message)}else{A("<- "+JSON.stringify(e.lastMessage))}typeof Pe.currentScreen.onConnectionMessage==="function"&&Pe.currentScreen.onConnectionMessage(t)}};oe.prototype.close=function(){if(this.open===false){return}this.webSocket=new WebSocket(this.url)};oe.prototype.send=function(e){if(this.open===false){return}A("-> "+e);this.webSocket.send(e);ie()};oe.prototype.sendJSON=function(e){if(this.open===false){return}A("-> "+JSON.stringify(e));this.webSocket.send(JSON.stringify(e));ie()};Fontello=window.Message||{};Fontello.icon={};Fontello.icon["icon-cancel"]="0xe800";Fontello.icon["icon-cog"]="0xe801";Fontello.icon["icon-award"]="0xe802";Fontello.icon["icon-left"]="0xe803";Fontello.get=function(e){if(typeof Fontello.icon[e]==="undefined"&&e.substring(0,5)!=="icon-"&&typeof Fontello.icon["icon-"+e]!=="undefined"){e="icon-"+e}return"&#"+Fontello.icon[e].substring(1)};Fontello.write=function(e){document.write(Fontello.get(e))};function se(){var e=this;this.board=new le;this.timerID;this.timeCount=0;this.startTime=0;this.mode=null;this.ai=false;this.end=false;this.aiDifficulty=null;this.activePlayerID=0;this.highlightedColumn=-1;this.timeouts=[];this.leaved=false;this.connectionClosed=false;this.moveCount=0;this.fallSpeed=.07;this.aiLayers=[];this.channel=null;warnCount=0;this.prepareDisc;this.discs=[];for(var t=0;t<ce.columns;t++){this.discs[t]=[];for(var n=0;n<ce.rows;n++){this.discs[t][n]=null}}this.yourID=0;this.opponentID=0;this.yourName=0;this.opponentName=0;this.yourColorID=0;this.opponentColorID=0;element.boardColumns.addEventListener("mousemove",function(t){e.onBoardMouseMove(e,t)});element.boardColumns.addEventListener("mouseup",function(t){e.onBoardMouseMove(e,t)});element.boardColumns.addEventListener("mouseout",function(t){e.onBoardMouseOut(e,t)});element.boardColumns.addEventListener("mouseup",function(t){e.onBoardMouseUp(e,t)});element.boardColumns.addEventListener("touchmove",function(t){e.onBoardTouchMove(e,t)});element.boardColumns.addEventListener("touchstart",function(t){e.onBoardTouchMove(e,t)});element.boardColumns.addEventListener("touchcancel",function(t){e.onBoardTouchLeave(e,t)});element.boardColumns.addEventListener("touchend",function(t){e.onBoardTouchEnd(e,t)})}se.prototype.initialize=function(){Pe.screenMainMenu.showAd=true;this.clearTimeouts();this.resetVars();this.updatePlayerInfo();this.board.clear();this.prepareElements();this.clearSelection();if(this.mode===me.online){this.startTimer(this.getTurnTime())}this.clearDiscs();if(this.ai===true&&this.activePlayerID===this.opponentID){this.goAI(this.opponentID)}this.addTimeout(function(){resize()},1)};se.prototype.terminate=function(){this.board.clear();this.clearSelection();this.mode=null;this.disableBoard();this.stopTimer();this.clearTimeouts();this.clearDiscs()};se.prototype.resetVars=function(){this.activePlayerID=0;this.highlightedColumn=-1;this.timeCount=0;this.end=false;this.leaved=false;this.connectionClosed=false;this.moveCount=0;this.aiLayers=[];this.warnCount=0};se.prototype.startTimer=function(e){this.timeCount=e||ce.turnTime;this.tick();this.stopTimer();this.timerID=setInterval(this.tick,1e3)};se.prototype.stopTimer=function(){clearInterval(this.timerID)};se.prototype.tick=function(){if(Se.timeCount<-1){return}var e='<div class="appear-arrow-text">'+Se.timeCount+"</div>";if(Se.timeCount===-1){e='<div class="arrow-text-warning">GO!</div>'}if(this.gameEnd!==true){if(Se.yourID===Se.activePlayerID){element.turnArrowTextYou.innerHTML=e}else{element.turnArrowTextOpponent.innerHTML=e}}else{this.setArrowText("")}if(Se.timeCount>=-1){Se.timeCount--}};se.prototype.clearTimeouts=function(){for(var e=0;e<this.timeouts.length;e++){clearTimeout(this.timeouts[e])}this.timeouts=[]};se.prototype.addTimeout=function(e,t){this.timeouts.push(setTimeout(e,t))};se.prototype.clearDiscs=function(){for(var e=0;e<ce.columns;e++){for(var t=0;t<ce.rows;t++){if(this.discs[e][t]!==null){this.discs[e][t].parentNode.removeChild(this.discs[e][t]);this.discs[e][t]=null}}}};se.prototype.clearSelection=function(){while(element.selectionContainer.lastChild){element.selectionContainer.removeChild(element.selectionContainer.lastChild)}};se.prototype.updatePlayerInfo=function(){var e=xe.lastMessage;switch(this.mode){case me.online:this.activePlayerID=e.start;this.yourID=e.yourID;this.opponentID=e.opponentID;if(e.yourName!==""){this.yourName=e.yourName}else{this.yourName="You"}if(e.opponentName!==""&&e.yourName!==e.opponentName){this.opponentName=e.opponentName}else{this.opponentName="Opponent"}this.yourColorID=e.yourColorID;this.opponentColorID=e.opponentColorID;this.startTime=e.startTime;this.yourIconFilename=e.yourIconFilename;this.opponentIconFilename=e.opponentIconFilename;break;case me.local:this.yourIconFilename="none";this.opponentIconFilename="none";this.activePlayerID=Math.round(Math.random()+1);this.yourID=1;this.opponentID=2;this.yourColorID=Math.round(Math.random()*(de.length-1));this.opponentColorID=(this.yourColorID+1)%de.length;if(this.ai===false){this.yourName="Player 1";this.opponentName="Player 2"}else{if(typeof serverData.user!=="undefined"&&he.activeIcon!=="none"){this.yourIconFilename=pe[he.activeIcon].filename}this.yourName="You";this.opponentName="AI ("+re(this.aiDifficulty)+")"}break}this.yourName=this.yourName.split(" ").join("&nbsp;");this.opponentName=this.opponentName.split(" ").join("&nbsp;")};se.prototype.prepareElements=function(){var e=this;this.setArrowText("");switch(this.mode){case me.online:if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard()}this.setArrowText(ce.turnTime);break;case me.local:if(this.ai===false){this.enableBoard()}else{if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard()}}this.setArrowText('<div id="arrow-text-go">GO!</div>');break}if(this.yourIconFilename!=="none"){element.smallDiscYou.innerHTML='<img class="disc-icon" src="/i/'+this.yourIconFilename+'">'}else{element.smallDiscYou.innerHTML=""}if(this.opponentIconFilename!=="none"){element.smallDiscOpponent.innerHTML='<img class="disc-icon" src="/i/'+this.opponentIconFilename+'">'}else{element.smallDiscOpponent.innerHTML=""}element.smallDiscYou.style.backgroundImage='url("'+de[this.yourColorID].disc+'")';element.smallDiscOpponent.style.backgroundImage='url("'+de[this.opponentColorID].disc+'")';element.turnArrowYou.style.backgroundImage='url("'+de[this.yourColorID].turnArrow+'")';element.turnArrowOpponent.style.backgroundImage='url("'+de[this.opponentColorID].turnArrow+'")';element.nameYou.innerHTML=this.yourName;element.nameOpponent.innerHTML=this.opponentName;element.winSmileyYou.style.backgroundImage='url("'+de[this.yourColorID].disc+'")';element.winSmileyOpponent.style.backgroundImage='url("'+de[this.opponentColorID].disc+'")';element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.remove("turn-left");this.addTimeout(function(){e.turnArrowToPlayer(e.activePlayerID)},1);element.cloudTitleOpponent.innerHTML="";element.cloudTitleOpponent.classList.add("hide");element.cloudTitleYou.innerHTML="";element.cloudTitleYou.classList.add("hide");element.rematchTitle.classList.add("hide");element.rematchTitle.innerHTML="";element.rematchTitle.classList.remove("pointer-events-none");element.rematchButton.classList.remove("pointer-events-none");element.rematchButton.classList.remove("crossed");if(Se.channel!==null&&this.mode===me.online){element.playAgainFindOpponentButton.classList.add("hide");element.rematchButton.classList.remove("hide");element.playAgainButton.classList.add("hide")}else if(this.mode===me.online){element.playAgainFindOpponentButton.classList.remove("hide");element.rematchButton.classList.remove("hide");element.playAgainButton.classList.add("hide")}else{element.playAgainFindOpponentButton.classList.add("hide");element.rematchButton.classList.add("hide");element.playAgainButton.classList.remove("hide")}if(this.ai===true){element.changeDifficulty.classList.remove("hide")}else{element.changeDifficulty.classList.add("hide")}element.selectionContainer.classList.add("hide");for(var t=0;t<element.boardColumnsArray.length;t++){element.boardColumnsArray[t].classList.remove("board-column-hide")}if(typeof this.prepareDisc==="undefined"){this.prepareDisc=document.createElement("div");this.prepareDisc.classList.add("disc");this.prepareDisc.classList.add("disc-row-start");element.discs.appendChild(this.prepareDisc)}};se.prototype.makeMove=function(e){if(this.board.get(e,0)===ce.emptyID){switch(this.mode){case me.online:if(this.activePlayerID===this.yourID){element.boardColumns.classList.remove("enabled");this.disableBoard();this.sendMove(e)}break;case me.local:this.addDisc(this.activePlayerID,e);this.activePlayerID=this.getOppositePlayer(this.activePlayerID);if(this.end===true){return}else{this.turnArrowToPlayer(this.activePlayerID)}if(this.ai===true){if(this.activePlayerID===this.yourID){this.enableBoard()}else{this.disableBoard();this.goAI(this.opponentID)}}break}}};se.prototype.sendMove=function(e){xe.send('{"move":'+e+"}")};se.prototype.addDisc=function(e,t){var n=this;var i=this.board.addDisc(e,t);if(typeof i==="undefined"){return}if(i===0){element.boardColumnsArray[t].classList.add("board-column-hide")}this.moveCount++;var o=(i+1.2)*this.fallSpeed*1e3;var s=this.prepareDisc;this.discs[t][i]=s;if(o>0){s.classList.add("disc-appear")}else{s.classList.add("disc-appear-slow")}s.classList.add("disc-col-"+t);s.style.webkitTransitionDuration=o+"ms";s.style.transitionDuration=o+"ms";s.style.backgroundImage="url('"+de[this.getPlayerColorID(e)].disc+"')";s.classList.add("disc-row-"+i);s.classList.remove("disc-row-start");var a;if(e===this.yourID){a=this.yourIconFilename}else{a=this.opponentIconFilename}if(a!=="none"){var r=document.createElement("img");r.src="/i/"+a;r.classList.add("disc-icon");s.appendChild(r)}this.gameEnd(t);this.prepareDisc=document.createElement("div");this.prepareDisc.classList.add("disc");this.prepareDisc.classList.add("disc-row-start");element.discs.appendChild(this.prepareDisc)};se.prototype.onConnectionMessage=function(){var e=this;if(this.mode!==me.online){return}var t=xe.lastMessage;var n=this.getTurnTime();if(t.hasOwnProperty("action")&&t.action==="expired"){if(!t.hasOwnProperty("end")){this.startTimer(n);this.activePlayerID=this.getOppositePlayer(t.playerID);if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard();this.warnCount++;element.cloudTitleYou.innerHTML=ve[this.warnCount]+" warn.<br>Play or you will be kicked!";element.cloudTitleYou.classList.remove("hide")}this.turnArrowToPlayer(this.activePlayerID)}}if(t.hasOwnProperty("action")&&t.action==="rematch"){element.rematchTitle.innerHTML="Opponent wants rematch";element.rematchTitle.classList.remove("hide");return}if(xe.lastMessage.hasOwnProperty("start")){if(Se.end===true){Message.remove();this.initialize()}return}if(t.hasOwnProperty("action")&&t.action==="leaved"){this.leaved=true;if(this.opponentID===t.playerID){element.cloudTitleOpponent.innerHTML="Opponent leaved";element.cloudTitleOpponent.classList.remove("hide")}if(this.end===false){this.end=true;this.stopTimer();element.cloudTitleYou.classList.add("hide");e.addTimeout(function(){e.disableBoard();e.setArrowText('<div class="appear-arrow-text"><span class="fontello">'+Fontello.get("award")+"</span></div>");e.turnArrowToPlayer(e.yourID);e.showWinScreen(t.playerID===e.opponentID)},500)}else{}element.rematchTitle.innerHTML="Opponent leaved";element.rematchButton.classList.add("crossed");return}if(t.hasOwnProperty("end")){this.end=true}if(t.hasOwnProperty("move")){this.startTimer(n);this.activePlayerID=this.getOppositePlayer(t.playerID);if(this.yourID==this.activePlayerID){this.enableBoard()}this.addDisc(t.playerID,t.move);if(this.board.checkVictory(t.move).victory===false){this.turnArrowToPlayer(this.activePlayerID)}}};se.prototype.onConnectionClose=function(e){if(this.mode===me.local){return}this.connectionClosed=true;this.stopTimer();this.disableBoard();if(this.end===false){element.turnArrow.classList.remove("turn-left");element.turnArrow.classList.remove("turn-right")}element.rematchButton.classList.add("crossed");if(e.code===ge.kickedDueToInactivity){element.cloudTitleYou.innerHTML="You were kicked due to inactivity"}else{element.cloudTitleYou.innerHTML="Connection closed"}element.cloudTitleYou.classList.remove("hide");this.end=true};se.prototype.getTurnTime=function(){return ce.turnTime};se.prototype.showWinScreen=function(e,t){X();if(this.ai===true){this.opponentName="AI"}var n=document.getElementsByClassName("game-end-promote");for(var i=0;i<n.length;i++){n[i].classList.add("hide")}if(n.length>0){n[Math.round(Math.random()*(n.length-1))].classList.remove("hide")}if(typeof t==="undefined"){t=false}var o="win";if(e){element.gameEndTitlePlayer.innerHTML=this.yourName;if(t===false){Message.funcWin[this.mode]()}else{Message.funcWinSpecial[this.mode]()}}else{var o="lose";element.gameEndTitlePlayer.innerHTML=this.opponentName;if(t===false||this.mode===me.online){Message.funcLose[this.mode]()}else{Message.funcLoseSpecial[this.mode]()}}ga("send",{hitType:"event",eventCategory:"GameEnd",eventAction:o,nonInteraction:true});W("game end")};se.prototype.gameEnd=function(e){var t=this;var n=this.board.checkVictory(e);if(n.victory===false&&i===false){return}var i=n.victory===false&&this.board.isFull()===true;var o=i||n.victory===true;var s=this.yourID;var a=this.opponentID;var r;for(var l=0;l<ce.rows;l++){r=this.board.get(e,l);if(this.board.get(e,l)!==ce.emptyID){break}}var d=500;if(n.victory===true){d=2e3}if(o===true){this.end=true;this.disableBoard();this.addTimeout(function(){if(n.victory===true){t.showWinScreen(r===s,n.winPoints>4)}else if(i===true){Message.funcDraw[t.mode]();t.setArrowText("X");element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.remove("turn-left")}},d)}if(n.victory===true){for(var c=0;c<n.discs.length;c++){var m="http://www.w3.org/2000/svg";var u=document.createElementNS(m,"svg");element.selectionContainer.appendChild(u);u.setAttributeNS(null,"viewBox",-ce.discRadius+" "+-ce.discRadius+" "+ce.discDiameter+" "+ce.discDiameter);u.setAttributeNS(null,"width",ce.discDiameter);u.setAttributeNS(null,"height",ce.discDiameter);u.classList.add("selection");u.classList.add("disc-col-"+n.discs[c].start.c);u.classList.add("disc-row-"+n.discs[c].start.r);var h=u.getBoundingClientRect();var p=0;var f=0;switch(n.discs[c].orientation){case ce.orientation.vertical:var g=Math.abs(n.discs[c].start.r-n.discs[c].end.r);f=(ce.discDiameter+ce.boardInnerPad)*g;p=90;break;case ce.orientation.horizontal:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*g;p=0;break;case ce.orientation.diagonal1:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*Math.SQRT2*g;p=45;break;case ce.orientation.diagonal2:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*Math.SQRT2*g;p=135;break}var y="M0,"+ce.selectionRadius;y+=" A"+ce.selectionRadius+","+ce.selectionRadius+" 0 0,1 0,"+-ce.selectionRadius;y+=" L"+f+","+-ce.selectionRadius;y+=" A"+ce.selectionRadius+","+ce.selectionRadius+" 0 0,1 "+f+","+ce.selectionRadius;y+=" Z";var v=document.createElementNS(m,"path");v.classList.add("selection-outline");v.setAttributeNS(null,"d",y);var b=document.createElementNS(m,"path");b.classList.add("selection-line");b.setAttributeNS(null,"d",y);u.style.webkitTransform="rotate("+p+"deg)";u.style.msTransform="rotate("+p+"deg)";u.style.transform="rotate("+p+"deg)";u.appendChild(v);u.appendChild(b);(function(e){e.classList.add("selection-blink")})(u)}this.addTimeout(function(){element.selectionContainer.classList.remove("hide");t.setArrowText('<div class="appear-arrow-text"><span class="fontello">'+Fontello.get("award")+"</span></div>")},500)}};se.prototype.enableBoard=function(){element.boardColumns.classList.add("enabled")};se.prototype.disableBoard=function(){element.boardColumns.classList.remove("enabled")};se.prototype.getOppositePlayer=function(e){if(e===this.yourID){return this.opponentID}else{return this.yourID}};se.prototype.getPlayerColorID=function(e){if(e===this.yourID){return this.yourColorID}else{return this.opponentColorID}};se.prototype.onBoardMouseMove=function(e,t){e.columnHighlightX(t.pageX,t.pageY)};se.prototype.onBoardMouseOut=function(e,t){e.removeColumnHighlight()};se.prototype.onBoardMouseUp=function(e,t){if(!element.boardColumns.classList.contains("enabled")){return}if(e.highlightedColumn!==-1){Se.makeMove(e.highlightedColumn)}element.cloudTitleYou.classList.add("hide");element.cloudTitleOpponent.classList.add("hide")};se.prototype.onBoardTouchMove=function(e,t){t.preventDefault();var n=t.touches[t.changedTouches.length-1].pageX;var i=t.touches[t.changedTouches.length-1].pageY;var o=element.boardColumns.getBoundingClientRect();if(n>=o.left&&n<=o.right&&i>=o.top&&i<=o.bottom){e.columnHighlightX(n,i)}else{e.removeColumnHighlight()}};se.prototype.onBoardTouchLeave=function(e,t){e.removeColumnHighlight()};se.prototype.onBoardTouchEnd=function(e,t){element.boardColumnsArray[this.highlightedColumn].classList.remove("highlight-column");if(!element.boardColumns.classList.contains("enabled")){return}if(e.highlightedColumn!==-1){Se.makeMove(e.highlightedColumn)}element.cloudTitleYou.classList.add("hide");element.cloudTitleOpponent.classList.add("hide");this.removeColumnHighlight()};se.prototype.columnHighlightX=function(e,t){if(!element.boardColumns.classList.contains("enabled")){return}var n=Number.MAX_VALUE;var i;for(var o=0;o<ce.columns;o++){var s=element.boardColumnsArray[o].getBoundingClientRect();var a=s.left+s.width/2;var r=Math.abs(a-e);if(r<n){n=r;i=o}}this.removeColumnHighlight();this.highlightedColumn=i;if(this.board.get(this.highlightedColumn,0)===ce.emptyID){element.boardColumnsArray[this.highlightedColumn].classList.add("highlight-column")}element.boardColumns.style.cursor="pointer"};se.prototype.removeColumnHighlight=function(){if(typeof element.boardColumnsArray[this.highlightedColumn]!=="undefined"){element.boardColumnsArray[this.highlightedColumn].classList.remove("highlight-column")}element.boardColumns.style.cursor="default";this.highlightedColumn=-1};se.prototype.turnArrowToPlayer=function(e){if(this.yourID===e){element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.add("turn-left")}else{element.turnArrow.classList.remove("turn-left");element.turnArrow.classList.add("turn-right")}};se.prototype.setArrowText=function(e){element.turnArrowTextYou.innerHTML=e;element.turnArrowTextOpponent.innerHTML=e};se.prototype.goAI=function(e){var t=this;if(this.end===true){return}var n;switch(this.aiDifficulty){case"easy":n=3;break;case"medium":n=4;break;case"hard":n=5;break;default:n=4}this.addTimeout(function(){var i;if(t.moveCount<3){i=Math.round(Math.random()*(ce.columns-1))}else{i=t.aiGetMove(e,n)}t.makeMove(i)},750)};function ae(e,t){this.board=new le;this.board.copy(e);this.parent=t;this.children=[];this.scoreAI=0;this.scoreOpponent=0;this.boardScore=0;this.score;this.aiTurn;this.depth;this.column}se.prototype.aiGetMove=function(e,t){var n=[];if(this.aiDifficulty==="easy"){if(Math.random()>.7){for(var i=0;i<ce.columns;i++){if(this.board.get(i,0)===ce.emptyID){n.push(i)}}return n[Math.round(Math.random()*(n.length-1))]}}this.aiLayers=[];for(var i=0;i<=t;i++){this.aiLayers[i]=[]}var o=this.aiMakeTree(e,this.board,t);for(var i=0;i<o.children.length;i++){if(o.children[i].boardScore===maxInt){return o.children[i].column}}var s=new le;for(var i=0;i<ce.columns;i++){if(this.board.get(i,0)!==ce.emptyID){continue}s.copy(this.board);s.addDisc(this.getOppositePlayer(e),i);var a=s.checkVictory(i);if(a.victory===true){return i}}this.aiSetScore();if(n.length===0){var r=o.children[0].score;for(var i=0;i<o.children.length;i++){if(o.children[i].score>r){r=o.children[i].score;n=[]}if(o.children[i].score>=r){n.push(o.children[i])}}}if(r===-maxInt){var l=true;for(var i=0;i<n;i++){if(n[i]!==-maxInt){l=false}}if(l===true){var s=new le;var d=[];for(var i=0;i<n.length;i++){if(this.board.get(i,0)!==ce.emptyID){continue}s.copy(this.board);s.addDisc(this.getOppositePlayer(e),n[i].column);var a=s.checkVictory(n[i].column);if(a.victory===true){d.push(n[i])}}if(d.length>0){n=d}}}var c=Math.round(Math.random()*(n.length-1));if(typeof n[c]==="undefined"||this.board.get(n[c].column,0)!==ce.emptyID){n=[];for(var i=0;i<o.children.length;i++){if(this.board.get(o.children[i].column,0)===ce.emptyID){n.push(o.children[i])}}c=Math.round(Math.random()*(n.length-1))}return n[c].column};se.prototype.aiMakeTree=function(e,t,n,i,o,s,a){if(s>n){return}var r=new le;r.copy(t);if(typeof i==="undefined"){e=this.getOppositePlayer(e);s=0;o=false}var l=new ae(t,i);l.depth=s;l.aiTurn=o;l.column=a;if(typeof i!=="undefined"){var d=r.checkVictory(a);var c;var m=d.maxPoints;if(d.victory===true){if(l.aiTurn){l.scoreAI=maxInt;l.scoreOpponent=0}else{l.scoreOpponent=-maxInt;l.scoreAI=0}}else{if(l.aiTurn){l.scoreAI=l.parent.scoreAI+m;l.scoreOpponent=l.parent.scoreOpponent}else{l.scoreOpponent=l.parent.scoreOpponent-m;l.scoreAI=l.parent.scoreAI}}c=l.scoreAI+l.scoreOpponent;l.boardScore=c}this.aiLayers[s].push(l);if(s===n||Math.abs(l.boardScore)===maxInt||typeof a==="defined"&&r.get(a,0)!==ce.emptyID){l.score=l.boardScore;return l}var u=new le;for(var h=0;h<ce.columns;h++){u.copy(r);if(u.get(h,0)!==ce.emptyID){continue}u.addDisc(this.getOppositePlayer(e),h);var p=this.aiMakeTree(this.getOppositePlayer(e),u,n,l,!o,s+1,h);if(typeof p!=="undefined"){l.children.push(p)}}return l};se.prototype.aiSetScore=function(){e:for(var e=this.aiLayers.length-1;e>=0;e--){t:for(var t=0;t<this.aiLayers[e].length;t++){var n=this.aiLayers[e][t];if(n.children.length>0){n:for(var i=0;i<n.children.length;i++){if(typeof n.score==="undefined"){n.score=n.children[i].score}else{if(!n.aiTurn){n.score=Math.max(n.score,n.children[i].score)}else{n.score=Math.min(n.score,n.children[i].score)}}}}}}};function re(e){return e.charAt(0).toUpperCase()+e.slice(1)}function se(){var e=this;this.board=new le;this.timerID;this.timeCount=0;this.startTime=0;this.mode=null;this.ai=false;this.end=false;this.aiDifficulty=null;this.activePlayerID=0;this.highlightedColumn=-1;this.timeouts=[];this.leaved=false;this.connectionClosed=false;this.moveCount=0;this.fallSpeed=.07;this.aiLayers=[];this.channel=null;warnCount=0;this.prepareDisc;this.discs=[];for(var t=0;t<ce.columns;t++){this.discs[t]=[];for(var n=0;n<ce.rows;n++){this.discs[t][n]=null}}this.yourID=0;this.opponentID=0;this.yourName=0;this.opponentName=0;this.yourColorID=0;this.opponentColorID=0;element.boardColumns.addEventListener("mousemove",function(t){e.onBoardMouseMove(e,t)});element.boardColumns.addEventListener("mouseup",function(t){e.onBoardMouseMove(e,t)});element.boardColumns.addEventListener("mouseout",function(t){e.onBoardMouseOut(e,t)});element.boardColumns.addEventListener("mouseup",function(t){e.onBoardMouseUp(e,t)});element.boardColumns.addEventListener("touchmove",function(t){e.onBoardTouchMove(e,t)});element.boardColumns.addEventListener("touchstart",function(t){e.onBoardTouchMove(e,t)});element.boardColumns.addEventListener("touchcancel",function(t){e.onBoardTouchLeave(e,t)});element.boardColumns.addEventListener("touchend",function(t){e.onBoardTouchEnd(e,t)})}se.prototype.initialize=function(){Pe.screenMainMenu.showAd=true;this.clearTimeouts();this.resetVars();this.updatePlayerInfo();this.board.clear();this.prepareElements();this.clearSelection();if(this.mode===me.online){this.startTimer(this.getTurnTime())}this.clearDiscs();if(this.ai===true&&this.activePlayerID===this.opponentID){this.goAI(this.opponentID)}this.addTimeout(function(){resize()},1)};se.prototype.terminate=function(){this.board.clear();this.clearSelection();this.mode=null;this.disableBoard();this.stopTimer();this.clearTimeouts();this.clearDiscs()};se.prototype.resetVars=function(){this.activePlayerID=0;this.highlightedColumn=-1;this.timeCount=0;this.end=false;this.leaved=false;this.connectionClosed=false;this.moveCount=0;this.aiLayers=[];this.warnCount=0};se.prototype.startTimer=function(e){this.timeCount=e||ce.turnTime;this.tick();this.stopTimer();this.timerID=setInterval(this.tick,1e3)};se.prototype.stopTimer=function(){clearInterval(this.timerID)};se.prototype.tick=function(){if(Se.timeCount<-1){return}var e='<div class="appear-arrow-text">'+Se.timeCount+"</div>";if(Se.timeCount===-1){e='<div class="arrow-text-warning">GO!</div>'}if(this.gameEnd!==true){if(Se.yourID===Se.activePlayerID){element.turnArrowTextYou.innerHTML=e}else{element.turnArrowTextOpponent.innerHTML=e}}else{this.setArrowText("")}if(Se.timeCount>=-1){Se.timeCount--}};se.prototype.clearTimeouts=function(){for(var e=0;e<this.timeouts.length;e++){clearTimeout(this.timeouts[e])}this.timeouts=[]};se.prototype.addTimeout=function(e,t){this.timeouts.push(setTimeout(e,t))};se.prototype.clearDiscs=function(){for(var e=0;e<ce.columns;e++){for(var t=0;t<ce.rows;t++){if(this.discs[e][t]!==null){this.discs[e][t].parentNode.removeChild(this.discs[e][t]);this.discs[e][t]=null}}}};se.prototype.clearSelection=function(){while(element.selectionContainer.lastChild){element.selectionContainer.removeChild(element.selectionContainer.lastChild)}};se.prototype.updatePlayerInfo=function(){var e=xe.lastMessage;switch(this.mode){case me.online:this.activePlayerID=e.start;this.yourID=e.yourID;this.opponentID=e.opponentID;if(e.yourName!==""){this.yourName=e.yourName}else{this.yourName="You"}if(e.opponentName!==""&&e.yourName!==e.opponentName){this.opponentName=e.opponentName}else{this.opponentName="Opponent"}this.yourColorID=e.yourColorID;this.opponentColorID=e.opponentColorID;this.startTime=e.startTime;this.yourIconFilename=e.yourIconFilename;this.opponentIconFilename=e.opponentIconFilename;break;case me.local:this.yourIconFilename="none";this.opponentIconFilename="none";this.activePlayerID=Math.round(Math.random()+1);this.yourID=1;this.opponentID=2;this.yourColorID=Math.round(Math.random()*(de.length-1));this.opponentColorID=(this.yourColorID+1)%de.length;if(this.ai===false){this.yourName="Player 1";this.opponentName="Player 2"}else{if(typeof serverData.user!=="undefined"&&he.activeIcon!=="none"){this.yourIconFilename=pe[he.activeIcon].filename}this.yourName="You";this.opponentName="AI ("+re(this.aiDifficulty)+")"}break}this.yourName=this.yourName.split(" ").join("&nbsp;");this.opponentName=this.opponentName.split(" ").join("&nbsp;")};se.prototype.prepareElements=function(){var e=this;this.setArrowText("");switch(this.mode){case me.online:if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard()}this.setArrowText(ce.turnTime);break;case me.local:if(this.ai===false){this.enableBoard()}else{if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard()}}this.setArrowText('<div id="arrow-text-go">GO!</div>');break}if(this.yourIconFilename!=="none"){element.smallDiscYou.innerHTML='<img class="disc-icon" src="/i/'+this.yourIconFilename+'">'}else{element.smallDiscYou.innerHTML=""}if(this.opponentIconFilename!=="none"){element.smallDiscOpponent.innerHTML='<img class="disc-icon" src="/i/'+this.opponentIconFilename+'">'}else{element.smallDiscOpponent.innerHTML=""}element.smallDiscYou.style.backgroundImage='url("'+de[this.yourColorID].disc+'")';element.smallDiscOpponent.style.backgroundImage='url("'+de[this.opponentColorID].disc+'")';element.turnArrowYou.style.backgroundImage='url("'+de[this.yourColorID].turnArrow+'")';element.turnArrowOpponent.style.backgroundImage='url("'+de[this.opponentColorID].turnArrow+'")';element.nameYou.innerHTML=this.yourName;element.nameOpponent.innerHTML=this.opponentName;element.winSmileyYou.style.backgroundImage='url("'+de[this.yourColorID].disc+'")';element.winSmileyOpponent.style.backgroundImage='url("'+de[this.opponentColorID].disc+'")';element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.remove("turn-left");this.addTimeout(function(){e.turnArrowToPlayer(e.activePlayerID)},1);element.cloudTitleOpponent.innerHTML="";element.cloudTitleOpponent.classList.add("hide");element.cloudTitleYou.innerHTML="";element.cloudTitleYou.classList.add("hide");element.rematchTitle.classList.add("hide");element.rematchTitle.innerHTML="";element.rematchTitle.classList.remove("pointer-events-none");element.rematchButton.classList.remove("pointer-events-none");element.rematchButton.classList.remove("crossed");if(Se.channel!==null&&this.mode===me.online){element.playAgainFindOpponentButton.classList.add("hide");element.rematchButton.classList.remove("hide");element.playAgainButton.classList.add("hide")}else if(this.mode===me.online){element.playAgainFindOpponentButton.classList.remove("hide");element.rematchButton.classList.remove("hide");element.playAgainButton.classList.add("hide")}else{element.playAgainFindOpponentButton.classList.add("hide");element.rematchButton.classList.add("hide");element.playAgainButton.classList.remove("hide")}if(this.ai===true){element.changeDifficulty.classList.remove("hide")}else{element.changeDifficulty.classList.add("hide")}element.selectionContainer.classList.add("hide");for(var t=0;t<element.boardColumnsArray.length;t++){element.boardColumnsArray[t].classList.remove("board-column-hide")}if(typeof this.prepareDisc==="undefined"){this.prepareDisc=document.createElement("div");this.prepareDisc.classList.add("disc");this.prepareDisc.classList.add("disc-row-start");element.discs.appendChild(this.prepareDisc)}};se.prototype.makeMove=function(e){if(this.board.get(e,0)===ce.emptyID){switch(this.mode){case me.online:if(this.activePlayerID===this.yourID){element.boardColumns.classList.remove("enabled");this.disableBoard();this.sendMove(e)}break;case me.local:this.addDisc(this.activePlayerID,e);this.activePlayerID=this.getOppositePlayer(this.activePlayerID);if(this.end===true){return}else{this.turnArrowToPlayer(this.activePlayerID)}if(this.ai===true){if(this.activePlayerID===this.yourID){this.enableBoard()}else{this.disableBoard();this.goAI(this.opponentID)}}break}}};se.prototype.sendMove=function(e){xe.send('{"move":'+e+"}")};se.prototype.addDisc=function(e,t){var n=this;var i=this.board.addDisc(e,t);if(typeof i==="undefined"){return}if(i===0){element.boardColumnsArray[t].classList.add("board-column-hide")}this.moveCount++;var o=(i+1.2)*this.fallSpeed*1e3;var s=this.prepareDisc;this.discs[t][i]=s;if(o>0){s.classList.add("disc-appear")}else{s.classList.add("disc-appear-slow")}s.classList.add("disc-col-"+t);s.style.webkitTransitionDuration=o+"ms";s.style.transitionDuration=o+"ms";s.style.backgroundImage="url('"+de[this.getPlayerColorID(e)].disc+"')";s.classList.add("disc-row-"+i);s.classList.remove("disc-row-start");var a;if(e===this.yourID){a=this.yourIconFilename}else{a=this.opponentIconFilename}if(a!=="none"){var r=document.createElement("img");r.src="/i/"+a;r.classList.add("disc-icon");s.appendChild(r)}this.gameEnd(t);this.prepareDisc=document.createElement("div");this.prepareDisc.classList.add("disc");this.prepareDisc.classList.add("disc-row-start");element.discs.appendChild(this.prepareDisc)};se.prototype.onConnectionMessage=function(){var e=this;if(this.mode!==me.online){return}var t=xe.lastMessage;var n=this.getTurnTime();if(t.hasOwnProperty("action")&&t.action==="expired"){if(!t.hasOwnProperty("end")){this.startTimer(n);this.activePlayerID=this.getOppositePlayer(t.playerID);if(this.yourID==this.activePlayerID){this.enableBoard()}else{this.disableBoard();this.warnCount++;element.cloudTitleYou.innerHTML=ve[this.warnCount]+" warn.<br>Play or you will be kicked!";element.cloudTitleYou.classList.remove("hide")}this.turnArrowToPlayer(this.activePlayerID)}}if(t.hasOwnProperty("action")&&t.action==="rematch"){element.rematchTitle.innerHTML="Opponent wants rematch";element.rematchTitle.classList.remove("hide");return}if(xe.lastMessage.hasOwnProperty("start")){if(Se.end===true){Message.remove();this.initialize()}return}if(t.hasOwnProperty("action")&&t.action==="leaved"){this.leaved=true;if(this.opponentID===t.playerID){element.cloudTitleOpponent.innerHTML="Opponent leaved";element.cloudTitleOpponent.classList.remove("hide")}if(this.end===false){this.end=true;this.stopTimer();element.cloudTitleYou.classList.add("hide");e.addTimeout(function(){e.disableBoard();e.setArrowText('<div class="appear-arrow-text"><span class="fontello">'+Fontello.get("award")+"</span></div>");e.turnArrowToPlayer(e.yourID);e.showWinScreen(t.playerID===e.opponentID)},500)}else{}element.rematchTitle.innerHTML="Opponent leaved";element.rematchButton.classList.add("crossed");return}if(t.hasOwnProperty("end")){this.end=true}if(t.hasOwnProperty("move")){this.startTimer(n);this.activePlayerID=this.getOppositePlayer(t.playerID);if(this.yourID==this.activePlayerID){this.enableBoard()}this.addDisc(t.playerID,t.move);if(this.board.checkVictory(t.move).victory===false){this.turnArrowToPlayer(this.activePlayerID)}}};se.prototype.onConnectionClose=function(e){if(this.mode===me.local){return}this.connectionClosed=true;this.stopTimer();this.disableBoard();if(this.end===false){element.turnArrow.classList.remove("turn-left");element.turnArrow.classList.remove("turn-right")}element.rematchButton.classList.add("crossed");if(e.code===ge.kickedDueToInactivity){element.cloudTitleYou.innerHTML="You were kicked due to inactivity"}else{element.cloudTitleYou.innerHTML="Connection closed"}element.cloudTitleYou.classList.remove("hide");this.end=true};se.prototype.getTurnTime=function(){return ce.turnTime};se.prototype.showWinScreen=function(e,t){X();if(this.ai===true){this.opponentName="AI"}var n=document.getElementsByClassName("game-end-promote");for(var i=0;i<n.length;i++){n[i].classList.add("hide")}if(n.length>0){n[Math.round(Math.random()*(n.length-1))].classList.remove("hide")}if(typeof t==="undefined"){t=false}var o="win";if(e){element.gameEndTitlePlayer.innerHTML=this.yourName;if(t===false){Message.funcWin[this.mode]()}else{Message.funcWinSpecial[this.mode]()}}else{var o="lose";element.gameEndTitlePlayer.innerHTML=this.opponentName;if(t===false||this.mode===me.online){Message.funcLose[this.mode]()}else{Message.funcLoseSpecial[this.mode]()}}ga("send",{hitType:"event",eventCategory:"GameEnd",eventAction:o,nonInteraction:true});W("game end")};se.prototype.gameEnd=function(e){var t=this;var n=this.board.checkVictory(e);if(n.victory===false&&i===false){return}var i=n.victory===false&&this.board.isFull()===true;var o=i||n.victory===true;var s=this.yourID;var a=this.opponentID;var r;for(var l=0;l<ce.rows;l++){r=this.board.get(e,l);if(this.board.get(e,l)!==ce.emptyID){break}}var d=500;if(n.victory===true){d=2e3}if(o===true){this.end=true;this.disableBoard();this.addTimeout(function(){if(n.victory===true){t.showWinScreen(r===s,n.winPoints>4)}else if(i===true){Message.funcDraw[t.mode]();t.setArrowText("X");element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.remove("turn-left")}},d)}if(n.victory===true){for(var c=0;c<n.discs.length;c++){var m="http://www.w3.org/2000/svg";var u=document.createElementNS(m,"svg");element.selectionContainer.appendChild(u);u.setAttributeNS(null,"viewBox",-ce.discRadius+" "+-ce.discRadius+" "+ce.discDiameter+" "+ce.discDiameter);u.setAttributeNS(null,"width",ce.discDiameter);u.setAttributeNS(null,"height",ce.discDiameter);u.classList.add("selection");u.classList.add("disc-col-"+n.discs[c].start.c);u.classList.add("disc-row-"+n.discs[c].start.r);var h=u.getBoundingClientRect();var p=0;var f=0;switch(n.discs[c].orientation){case ce.orientation.vertical:var g=Math.abs(n.discs[c].start.r-n.discs[c].end.r);f=(ce.discDiameter+ce.boardInnerPad)*g;p=90;break;case ce.orientation.horizontal:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*g;p=0;break;case ce.orientation.diagonal1:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*Math.SQRT2*g;p=45;break;case ce.orientation.diagonal2:var g=Math.abs(n.discs[c].start.c-n.discs[c].end.c);f=(ce.discDiameter+ce.boardInnerPad)*Math.SQRT2*g;p=135;break}var y="M0,"+ce.selectionRadius;y+=" A"+ce.selectionRadius+","+ce.selectionRadius+" 0 0,1 0,"+-ce.selectionRadius;y+=" L"+f+","+-ce.selectionRadius;y+=" A"+ce.selectionRadius+","+ce.selectionRadius+" 0 0,1 "+f+","+ce.selectionRadius;y+=" Z";var v=document.createElementNS(m,"path");v.classList.add("selection-outline");v.setAttributeNS(null,"d",y);var b=document.createElementNS(m,"path");b.classList.add("selection-line");b.setAttributeNS(null,"d",y);u.style.webkitTransform="rotate("+p+"deg)";u.style.msTransform="rotate("+p+"deg)";u.style.transform="rotate("+p+"deg)";u.appendChild(v);u.appendChild(b);(function(e){e.classList.add("selection-blink")})(u)}this.addTimeout(function(){element.selectionContainer.classList.remove("hide");t.setArrowText('<div class="appear-arrow-text"><span class="fontello">'+Fontello.get("award")+"</span></div>")},500)}};se.prototype.enableBoard=function(){element.boardColumns.classList.add("enabled")};se.prototype.disableBoard=function(){element.boardColumns.classList.remove("enabled")};se.prototype.getOppositePlayer=function(e){if(e===this.yourID){return this.opponentID}else{return this.yourID}};se.prototype.getPlayerColorID=function(e){if(e===this.yourID){return this.yourColorID}else{return this.opponentColorID}};se.prototype.onBoardMouseMove=function(e,t){e.columnHighlightX(t.pageX,t.pageY)};se.prototype.onBoardMouseOut=function(e,t){e.removeColumnHighlight()};se.prototype.onBoardMouseUp=function(e,t){if(!element.boardColumns.classList.contains("enabled")){return}if(e.highlightedColumn!==-1){Se.makeMove(e.highlightedColumn)}element.cloudTitleYou.classList.add("hide");element.cloudTitleOpponent.classList.add("hide")};se.prototype.onBoardTouchMove=function(e,t){t.preventDefault();var n=t.touches[t.changedTouches.length-1].pageX;var i=t.touches[t.changedTouches.length-1].pageY;var o=element.boardColumns.getBoundingClientRect();if(n>=o.left&&n<=o.right&&i>=o.top&&i<=o.bottom){e.columnHighlightX(n,i)}else{e.removeColumnHighlight()}};se.prototype.onBoardTouchLeave=function(e,t){e.removeColumnHighlight()};se.prototype.onBoardTouchEnd=function(e,t){element.boardColumnsArray[this.highlightedColumn].classList.remove("highlight-column");if(!element.boardColumns.classList.contains("enabled")){return}if(e.highlightedColumn!==-1){Se.makeMove(e.highlightedColumn)}element.cloudTitleYou.classList.add("hide");element.cloudTitleOpponent.classList.add("hide");this.removeColumnHighlight()};se.prototype.columnHighlightX=function(e,t){if(!element.boardColumns.classList.contains("enabled")){return}var n=Number.MAX_VALUE;var i;for(var o=0;o<ce.columns;o++){var s=element.boardColumnsArray[o].getBoundingClientRect();var a=s.left+s.width/2;var r=Math.abs(a-e);if(r<n){n=r;i=o}}this.removeColumnHighlight();this.highlightedColumn=i;if(this.board.get(this.highlightedColumn,0)===ce.emptyID){element.boardColumnsArray[this.highlightedColumn].classList.add("highlight-column")}element.boardColumns.style.cursor="pointer"};se.prototype.removeColumnHighlight=function(){if(typeof element.boardColumnsArray[this.highlightedColumn]!=="undefined"){element.boardColumnsArray[this.highlightedColumn].classList.remove("highlight-column")}element.boardColumns.style.cursor="default";this.highlightedColumn=-1};se.prototype.turnArrowToPlayer=function(e){if(this.yourID===e){element.turnArrow.classList.remove("turn-right");element.turnArrow.classList.add("turn-left")}else{element.turnArrow.classList.remove("turn-left");element.turnArrow.classList.add("turn-right")}};se.prototype.setArrowText=function(e){element.turnArrowTextYou.innerHTML=e;element.turnArrowTextOpponent.innerHTML=e};se.prototype.goAI=function(e){var t=this;if(this.end===true){return}var n;switch(this.aiDifficulty){case"easy":n=3;break;case"medium":n=4;break;case"hard":n=5;break;default:n=4}this.addTimeout(function(){var i;if(t.moveCount<3){i=Math.round(Math.random()*(ce.columns-1))}else{i=t.aiGetMove(e,n)}t.makeMove(i)},750)};function ae(e,t){this.board=new le;this.board.copy(e);this.parent=t;this.children=[];this.scoreAI=0;this.scoreOpponent=0;this.boardScore=0;this.score;this.aiTurn;this.depth;this.column}se.prototype.aiGetMove=function(e,t){var n=[];if(this.aiDifficulty==="easy"){if(Math.random()>.7){for(var i=0;i<ce.columns;i++){if(this.board.get(i,0)===ce.emptyID){n.push(i)}}return n[Math.round(Math.random()*(n.length-1))]}}this.aiLayers=[];for(var i=0;i<=t;i++){this.aiLayers[i]=[]}var o=this.aiMakeTree(e,this.board,t);for(var i=0;i<o.children.length;i++){if(o.children[i].boardScore===maxInt){return o.children[i].column}}var s=new le;for(var i=0;i<ce.columns;i++){if(this.board.get(i,0)!==ce.emptyID){continue}s.copy(this.board);s.addDisc(this.getOppositePlayer(e),i);var a=s.checkVictory(i);if(a.victory===true){return i}}this.aiSetScore();if(n.length===0){var r=o.children[0].score;for(var i=0;i<o.children.length;i++){if(o.children[i].score>r){r=o.children[i].score;n=[]}if(o.children[i].score>=r){n.push(o.children[i])}}}if(r===-maxInt){var l=true;for(var i=0;i<n;i++){if(n[i]!==-maxInt){l=false}}if(l===true){var s=new le;var d=[];for(var i=0;i<n.length;i++){if(this.board.get(i,0)!==ce.emptyID){continue}s.copy(this.board);s.addDisc(this.getOppositePlayer(e),n[i].column);var a=s.checkVictory(n[i].column);if(a.victory===true){d.push(n[i])}}if(d.length>0){n=d}}}var c=Math.round(Math.random()*(n.length-1));if(typeof n[c]==="undefined"||this.board.get(n[c].column,0)!==ce.emptyID){n=[];for(var i=0;i<o.children.length;i++){if(this.board.get(o.children[i].column,0)===ce.emptyID){n.push(o.children[i])}}c=Math.round(Math.random()*(n.length-1))}return n[c].column};se.prototype.aiMakeTree=function(e,t,n,i,o,s,a){if(s>n){return}var r=new le;r.copy(t);if(typeof i==="undefined"){e=this.getOppositePlayer(e);s=0;o=false}var l=new ae(t,i);l.depth=s;l.aiTurn=o;l.column=a;if(typeof i!=="undefined"){var d=r.checkVictory(a);var c;var m=d.maxPoints;if(d.victory===true){if(l.aiTurn){l.scoreAI=maxInt;l.scoreOpponent=0}else{l.scoreOpponent=-maxInt;l.scoreAI=0}}else{if(l.aiTurn){l.scoreAI=l.parent.scoreAI+m;l.scoreOpponent=l.parent.scoreOpponent}else{l.scoreOpponent=l.parent.scoreOpponent-m;l.scoreAI=l.parent.scoreAI}}c=l.scoreAI+l.scoreOpponent;l.boardScore=c}this.aiLayers[s].push(l);if(s===n||Math.abs(l.boardScore)===maxInt||typeof a==="defined"&&r.get(a,0)!==ce.emptyID){l.score=l.boardScore;return l}var u=new le;for(var h=0;h<ce.columns;h++){u.copy(r);if(u.get(h,0)!==ce.emptyID){continue}u.addDisc(this.getOppositePlayer(e),h);var p=this.aiMakeTree(this.getOppositePlayer(e),u,n,l,!o,s+1,h);if(typeof p!=="undefined"){l.children.push(p)}}return l};se.prototype.aiSetScore=function(){e:for(var e=this.aiLayers.length-1;e>=0;e--){t:for(var t=0;t<this.aiLayers[e].length;t++){var n=this.aiLayers[e][t];if(n.children.length>0){n:for(var i=0;i<n.children.length;i++){if(typeof n.score==="undefined"){n.score=n.children[i].score}else{if(!n.aiTurn){n.score=Math.max(n.score,n.children[i].score)}else{n.score=Math.min(n.score,n.children[i].score)}}}}}}};function re(e){return e.charAt(0).toUpperCase()+e.slice(1)}function le(){this.cells=[];this.clear()}le.prototype.clear=function(){for(var e=0;e<ce.columns*ce.rows;e++){this.cells[e]=ce.emptyID}};le.prototype.get=function(e,t){return this.cells[ce.columns*t+e]};le.prototype.set=function(e,t,n){this.cells[ce.columns*t+e]=n};le.prototype.addDisc=function(e,t){if(t<0||t>ce.columns-1){}var n=t;if(this.get(n,0)===ce.emptyID){for(var i=ce.rows-1;i>=0;i--){if(this.get(n,i)===ce.emptyID){this.set(n,i,e);return i}}}else{}};le.prototype.checkVictory=function(e){var t;for(var n=0;n<ce.rows;n++){t=n;if(this.get(e,n)!==ce.emptyID){break}}var i=e;var o=3;var s=this.get(i,t);var a=this.checkVictoryHelper(s,i,t-o,0,+1,7);var r=this.checkVictoryHelper(s,i-o,t,+1,0,7);var l=this.checkVictoryHelper(s,i-o,t-o,+1,+1,7);var d=this.checkVictoryHelper(s,i+o,t-o,-1,+1,7);var c={maxPoints:Math.max(a.points,r.points,l.points,d.points),winPoints:0,victory:false};if(a.victory||r.victory||l.victory||d.victory){c.victory=true;c.discs=[]}if(a.victory){c.discs.push({orientation:ce.orientation.vertical,add:{c:0,r:1},start:a.start,end:a.end});c.winPoints+=a.points}if(r.victory){c.discs.push({orientation:ce.orientation.horizontal,add:{c:1,r:0},start:r.start,end:r.end});c.winPoints+=r.points}if(l.victory){c.discs.push({orientation:ce.orientation.diagonal1,add:{c:1,r:1},start:l.start,end:l.end});c.winPoints+=l.points}if(d.victory){c.discs.push({orientation:ce.orientation.diagonal2,add:{c:-1,r:1},start:d.start,end:d.end});c.winPoints+=d.points}return c};le.prototype.checkVictoryHelper=function(e,t,n,i,o,s){var a=0;var r;var l;var d=0;for(var c=0;c<s;c++){var m=t+i*c;var u=n+o*c;if(m>=0&&m<ce.columns&&u>=0&&u<ce.rows){if(this.get(m,u)===e){a++;d=Math.max(d,a);if(a===1){r={c:m,r:u}}if(a>=4){l={c:m,r:u}}}else{if(a<4){a=0}else{break}}}}returnObject={victory:a>=4,start:r,end:l,points:d};return returnObject};le.prototype.isFull=function(){for(var e=0;e<ce.columns;e++){if(this.get(e,0)===ce.emptyID){return false}}return true};le.prototype.testPrint=function(){var e="";for(var t=0;t<this.cells.length;t++){e+=this.cells[t]+" ";if((t+1)%ce.columns===0&&t!==0){e+="\n"}}return e};le.prototype.copy=function(e){for(var t=0;t<this.cells.length;t++){this.cells[t]=e.cells[t]}};var de=[{disc:"/assets/disc-0.svg",turnArrow:"/assets/turn-arrow-0.svg"},{disc:"/assets/disc-1.svg",turnArrow:"/assets/turn-arrow-1.svg"}];var ce={columns:7,rows:6,emptyID:0,p1ID:1,p2ID:2,discDiameter:40,discRadius:null,boardInnerPad:10,turnTime:15,selectionDiameter:51,selectionRadius:null,orientation:{horizontal:0,vertical:1,diagonal1:2,diagonal2:3}};var me={online:0,local:1,ai:2};var ue={gameBoardHeight:330,gameBoardWidth:400};var he=serverData.user;var pe=serverData.icons;function fe(){element.content=document.getElementById("content");element.socialBar=document.getElementById("social-bar");element.screens=document.getElementById("screens");element.cookies=document.getElementById("cookies");element.screenLoading=document.getElementById("screen-loading");element.screenMainMenu=document.getElementById("screen-main-menu");element.screenFindOpponent=document.getElementById("screen-find-opponent");element.screenGame=document.getElementById("screen-game");element.screenInviteFriend=document.getElementById("screen-invite-friend");element.screenWaitForFriend=document.getElementById("screen-wait-for-friend");element.screenInvited=document.getElementById("screen-invited");element.screenMore=document.getElementById("screen-more");element.screenIcons=document.getElementById("screen-icons");element.screenProfile=document.getElementById("screen-profile");element.screenBuyGold=document.getElementById("screen-buy-gold");element.menuButtonLogin=document.getElementById("menu-button-login");element.menuButtonProfile=document.getElementById("menu-button-profile");element.menuButtonFindOpponent=document.getElementById("menu-button-find-opponent");element.menuButtonInviteFriend=document.getElementById("menu-button-invite-friend");element.menuButtonLocalMultiplayer=document.getElementById("menu-button-local-multiplayer");element.menuButtonPlayAgainstAi=document.getElementById("menu-button-play-against-ai");element.menuButtonMoreGames=document.getElementById("menu-button-more-games");element.menuButtonMore=document.getElementById("menu-button-more");element.menuButtonInviteFriendsFacebook=document.getElementById("menu-button-invite-friends-facebook");element.profileButtonChangeIcon=document.getElementById("profile-button-change-icon");element.profileButtonBuyIcons=document.getElementById("profile-button-buy-icons");element.profileButtonBuyGold=document.getElementById("profile-button-buy-gold");element.profileButtonLogout=document.getElementById("profile-button-logout");element.profileButtonChest=document.getElementById("profile-button-chest");element.profileChestText=document.getElementById("profile-chest-text");element.profileName=document.getElementById("profile-name");element.profileProvider=document.getElementById("profile-provider");element.profileID=document.getElementById("profile-id");element.profileIcon=document.getElementById("profile-icon");element.chestNotOpen=document.getElementById("chest-not-open");element.chestReady=document.getElementById("chest-ready");element.chestLocked=document.getElementById("chest-locked");element.chestSuccess=document.getElementById("chest-success");element.chestError=document.getElementById("chest-error");element.chestTime=document.getElementsByClassName("chest-time");element.chestOpenImg=document.getElementById("chest-open-img");element.chestErrorContent=document.getElementById("chest-error-content");element.chestCoin=document.getElementById("chest-coin");element.chestObtainedGold=document.getElementById("chest-obtained-gold");element.adMainChest=document.getElementById("ad-main-chest");element.adMainChestReady=document.getElementById("ad-main-chest-ready");element.adMainChestLocked=document.getElementById("ad-main-chest-locked");element.promoteRegister200x200=document.getElementById("promote-register-200x200");element.promoteBuyGold200x200=document.getElementById("promote-buy-gold-200x200");element.promoteBuyIcons200x200=document.getElementById("promote-buy-icons-200x200");element.promoteRegister496x150=document.getElementById("promote-register-496x150");element.promoteBuyGold496x150=document.getElementById("promote-buy-gold-496x150");element.promoteBuyIcons496x150=document.getElementById("promote-buy-icons-496x150");element.buyGoldButtonGroup=document.getElementById("buy-gold-button-group");element.buyGold200=document.getElementById("buy-gold-200");element.buyGold600=document.getElementById("buy-gold-600");element.buyGold1300=document.getElementById("buy-gold-1300");element.buyGold2100=document.getElementById("buy-gold-2100");element.buyGold3000=document.getElementById("buy-gold-3000");element.inviteGoButton=document.getElementById("invite-go-button");element.invitedGoButton=document.getElementById("invited-go-button");element.messageBoxBackground=document.getElementById("message-box-background");element.messageBox=document.getElementById("message-box");element.errorBox=document.getElementById("error-box");element.errorTitle=document.getElementById("error-title");element.embedBox=document.getElementById("embed-box");element.aiBox=document.getElementById("ai-box");element.loginBox=document.getElementById("login-box");element.askBuyIconBox=document.getElementById("ask-buy-icon-box");element.notEnoughGoldBox=document.getElementById("not-enough-gold-box");element.justBoughtBox=document.getElementById("just-bought-box");element.chestBox=document.getElementById("chest-box");element.chestLoginRequiredBox=document.getElementById("chest-login-required-box");element.buyGoldLoginRequiredBox=document.getElementById("buy-gold-login-required-box");element.buyIconsLoginRequiredBox=document.getElementById("buy-icons-login-required-box");element.gameEndTitlePlayer=document.getElementById("game-end-title-player");element.gameEndTitleYou=document.getElementById("game-end-title-you");element.gameEndTitleOpponent=document.getElementById("game-end-title-opponent");element.gameEndTitleWon=document.getElementById("game-end-title-won");element.gameEndTitleLose=document.getElementById("game-end-title-lose");element.gameEndTitleDraw=document.getElementById("game-end-title-draw");element.winSmileyYou=document.getElementById("win-smiley-you");element.winSmileyYouContainer=document.getElementById("win-smiley-you-container");element.winSmileyOpponent=document.getElementById("win-smiley-opponent");element.winSmileyOpponentContainer=document.getElementById("win-smiley-opponent-container");element.sunglasses=document.getElementById("sunglasses");element.rematchTitle=document.getElementById("rematch-title");element.rematchButton=document.getElementById("rematch-button");element.playAgainButton=document.getElementById("play-again-button");element.exitToMenuButton=document.getElementById("exit-to-menu-button");element.playAgainFindOpponentButton=document.getElementById("play-again-find-opponent-button");element.changeDifficulty=document.getElementById("change-difficulty");element.playerFieldYou=document.getElementById("player-field-you");element.playerFieldOpponent=document.getElementById("player-field-opponent");element.smallDiscYou=document.getElementById("small-disc-you");element.smallDiscOpponent=document.getElementById("small-disc-opponent");element.nameYou=document.getElementById("name-you");element.nameOpponent=document.getElementById("name-opponent");element.turnArrowContainer=document.getElementById("turn-arrow-container");element.turnArrow=document.getElementById("turn-arrow");element.turnArrowYou=document.getElementById("turn-arrow-you");element.turnArrowOpponent=document.getElementById("turn-arrow-opponent");element.turnArrowTextYou=document.getElementById("turn-arrow-text-you");element.turnArrowTextOpponent=document.getElementById("turn-arrow-text-opponent");element.cloudTitleYou=document.getElementById("cloud-title-you");element.cloudTitleOpponent=document.getElementById("cloud-title-opponent");element.gameBoardContainer=document.getElementById("game-board-container");element.gameBoard=document.getElementById("game-board");element.board=document.getElementById("board");element.boardColumns=document.getElementById("board-columns");element.boardColumn0=document.getElementById("board-column-0");element.boardColumn1=document.getElementById("board-column-1");element.boardColumn2=document.getElementById("board-column-2");element.boardColumn3=document.getElementById("board-column-3");element.boardColumn4=document.getElementById("board-column-4");element.boardColumn5=document.getElementById("board-column-5");element.boardColumn6=document.getElementById("board-column-6");element.boardColumnsArray=[element.boardColumn0,element.boardColumn1,element.boardColumn2,element.boardColumn3,element.boardColumn4,element.boardColumn5,element.boardColumn6];element.nameInput=document.getElementById("name-input");element.uniqueChannelButton=document.getElementById("unique-channel-button");element.channelInput=document.getElementById("channel-input");element.shareLinkArea=document.getElementById("share-link-area");element.aboutToPlayChannel=document.getElementById("about-to-play-channel");element.nameInputInvited=document.getElementById("name-input-invited");element.logArea=document.getElementById("log-area");element.toggleLog=document.getElementById("toggle-log");element.findOpponentTitle=document.getElementById("find-opponent-title");element.findOpponentTitleLink=document.getElementById("find-opponent-title-link");element.findOpponentPreloader=document.getElementById("finding-opponent-preloader");element.findOpponentInviteFriendButton=document.getElementById("finding-opponent-invite-friend-button");element.findOpponentFindOpponentButton=document.getElementById("finding-opponent-find-opponent-button");element.findOpponentTryAgainButton=document.getElementById("finding-opponent-try-again-button");element.waitForFriendTitle=document.getElementById("wait-for-friend-title");element.channel=document.getElementById("channel");element.hoverDisc=document.getElementById("hover-disc");element.discs=document.getElementById("discs");element.selectionContainer=document.getElementById("selection-container");element.navigation=document.getElementById("navigation");element.leave=document.getElementById("leave");element.back=document.getElementById("back");element.leaveButton=document.getElementById("leave-button");element.keepPlayingButton=document.getElementById("keep-playing-button");element.errorOkButton=document.getElementById("error-ok-button");element.embedOkButton=document.getElementById("embed-ok-button");element.settingsDarkSkin=document.getElementById("settings-dark-skin");element.settingsLargeBoard=document.getElementById("settings-large-board");element.settingsFallSpeed=document.getElementById("settings-fall-speed");element.settingsAiDifficulty=document.getElementById("settings-ai-difficulty");element.embedCode=document.getElementById("embed-code");element.embedSettingsWidth=document.getElementById("embed-settings-width");element.embedSettingsHeight=document.getElementById("embed-settings-height");element.embedSettingsDarkSkin=document.getElementById("embed-settings-dark-skin");element.embed=document.getElementById("embed");element.aiDifficultyEasy=document.getElementById("ai-difficulty-easy");element.aiDifficultyMedium=document.getElementById("ai-difficulty-medium");element.aiDifficultyHard=document.getElementById("ai-difficulty-hard");element.playersOnline=document.getElementById("players-online");element.promoteFacebook=document.getElementById("promote-facebook");element.promoteChrome=document.getElementById("promote-chrome");element.promoteChromeRating=document.getElementById("promote-chrome-rating");element.loginGoogle=document.getElementById("login-google");element.loginFacebook=document.getElementById("login-facebook");element.yourIcons=document.getElementById("your-icons");element.buyIcons=document.getElementById("buy-icons");element.askBuyIconImage=document.getElementById("ask-buy-icon-image");element.askBuyIconGold=document.getElementById("ask-buy-icon-gold");element.askBuyIconYes=document.getElementById("ask-buy-icon-yes");element.askBuyIconNo=document.getElementById("ask-buy-icon-no");element.moreGoldIconImage=document.getElementById("more-gold-icon-image");element.moreGoldIconGold=document.getElementById("more-gold-icon-gold");element.justBoughtIconImage=document.getElementById("just-bought-icon-image");element.yourGold=document.getElementsByClassName("your-gold");element.buyMoreGold=document.getElementById("buy-more-gold");element.chestLogin=document.getElementById("chest-login");element.buyGoldLogin=document.getElementById("buy-gold-login");element.buyIconsLogin=document.getElementById("buy-icons-login");element.gameEndAd=document.getElementById("game-end-ad");element.mainMenuAd=document.getElementById("main-menu-ad");element.ingameAd=document.getElementById("ingame-ad");element.ingameAd2=document.getElementById("ingame-ad-2");element.ingameAd2Content=document.getElementById("ingame-ad-2-content");element.ingameAd2Hide=document.getElementById("ingame-ad-2-hide");element.mainMenuTopAd=document.getElementById("main-menu-top-ad");element.findOpponentAd=document.getElementById("find-opponent-ad");element.partners=document.getElementById("partners")}var ge={other:4e3,messageQuotaExceeded:4001,idleTimeExceeded:4002,tooManyConnectionsFromSameAddress:4003,kickedDueToInactivity:4004};var ye={1e3:"Normal closure.",1001:"Going away.",1002:"Protocol error.",1003:"Unsupported data.",1005:"No status received.",1006:"Abnormal closure.",1007:"Invalid frame payload data.",1008:"Policy violation.",1009:"Message too big.",1010:"Mandatory extension.",1011:"Internal server error.",1012:"Service restart.",1013:"Try again later.",1015:"TLS handshake.",4001:"Message quota exceeded.",4002:"Idle time exceeded.",4003:"Too many connections from same address.",4004:"Kicked due to inactivity."};var ve=[null,"1st","2nd","3rd"];var be=["api","connect","embed","auth","logout","main"];maxInt=9007199254740991;domain="c4arena.com";reloadIngameAdFlag=true;ce.discRadius=ce.discDiameter/2;ce.selectionRadius=ce.selectionDiameter/2;var Ie=function(){var e={};var t=window.location.search.substring(1);var n=t.split("&");for(var i=0;i<n.length;i++){var o=n[i].split("=");if(typeof e[o[0]]==="undefined"){e[o[0]]=decodeURIComponent(o[1])}else if(typeof e[o[0]]==="string"){var s=[e[o[0]],decodeURIComponent(o[1])];e[o[0]]=s}else{e[o[0]].push(decodeURIComponent(o[1]))}}return e}();var Le;var we;var Me;function Be(){if(typeof serverData.user==="undefined"){return}var e=document.createElement("img");e.src="/assets/none.svg";e.classList.add("icon");e.classList.add("icon-none");element.yourIcons.appendChild(e);n(e,function(){ke("none")});sortedIcons=[];Object.keys(pe).forEach(function(e,t){sortedIcons.push({icon:pe[e],key:e})});sortedIcons.sort(function e(t,n){if(t.icon.price<n.icon.price){return-1}if(t.icon.price>n.icon.price){return 1}if(t.icon.displayName<n.icon.displayName){return-1}if(t.icon.displayName>n.icon.displayName){return 1}return 0});for(var t=0;t<sortedIcons.length;t++){(function(){var e=sortedIcons[t].key;var i=document.createElement("div");var o='<img src="/i/'+pe[e].filename+'">';o+='<div class="icon-label">';o+='<div class="label-selected">SELECTED</div>';o+='<div class="price">'+pe[e].price+"</div>";o+="</div>";i.innerHTML=o;i.classList.add("icon");if(pe[e].isPublic===false){i.classList.add("icon-not-public")}pe[e].element=i;if(e===he.activeIcon){i.classList.add("selected-icon")}var s=document.createElement("img");if(pe[e].isOwned===true||pe[e].isFree===true){element.yourIcons.appendChild(i)}else{element.buyIcons.appendChild(i)}n(i,function(){Te(e)})})()}}function Te(e){if(pe[e].isOwned===true||pe[e].isFree===true){ke(e)}else{De(e)}}function ke(e){if(he.activeIcon!=="none"&&typeof pe[he.activeIcon].element!=="undefined"){pe[he.activeIcon].element.classList.remove("selected-icon")}he.activeIcon=e;element.profileIcon.classList.add("hide");if(e!=="none"){pe[he.activeIcon].element.classList.add("selected-icon")}else{}}function Ce(e){c.post("/api/set-active-icon/"+e,null,Ee)}function Ee(e){var t=JSON.parse(e);if(typeof t.success!=="undefined"&&t.success===true){element.profileIcon.classList.remove("hide");if(t["active-icon"]!=="none"){element.profileIcon.src="/i/"+pe[t["active-icon"]].filename}else{element.profileIcon.src="/assets/none.svg"}}else{Message.addTop(element.errorBox,function(){element.errorTitle.innerHTML="Error:<br>"+t.error},true)}}function De(e){if(he.gold>=pe[e].price){Me=e;Message.addTop(element.askBuyIconBox,null,true);element.askBuyIconImage.src=/i/+pe[e].filename;element.askBuyIconGold.innerHTML=pe[e].price}else{Message.addTop(element.notEnoughGoldBox,null,true);element.moreGoldIconImage.src=/i/+pe[e].filename;element.moreGoldIconGold.innerHTML=pe[e].price}}function Oe(e){var t=JSON.parse(e);if(typeof t.success!=="undefined"&&t.success===true){console.log("success");Ae(t.gold);pe[t.icon].isOwned=true;element.yourIcons.appendChild(pe[t.icon].element);Message.addTop(element.justBoughtBox,null,true);element.justBoughtIconImage.src=/i/+pe[t.icon].filename}else{Message.addTop(element.errorBox,function(){element.errorTitle.innerHTML="Error:<br>"+t.error},true)}document.body.classList.remove("processing-visible");resize()}function Ae(e){he.gold=e;for(var t=0;t<element.yourGold.length;t++){element.yourGold[t].innerHTML=e}}H(["/assets/preloader.svg","/assets/background.svg","/assets/board-dark.svg","/assets/board.svg","/assets/column-highlight.svg","/assets/disc-0.svg","/assets/disc-1.svg","/assets/smiley-happy.svg","/assets/smiley-sad.svg","/assets/turn-arrow-0.svg","/assets/turn-arrow-1.svg"]);var Se;var xe;var Pe;if(document.location.href.slice(-1)==="#"){history.replaceState({},document.title,document.location.href.slice(0,-1))}if(document.addEventListener){window.addEventListener("load",Ne)}else{window.attachEvent("onload",Ne)}function He(){if(document.readyState==="complete"){Ne()}}var Fe=true;window.onfocus=function(){Fe=true;if(document.title.substring(0,3)==="!!!"){document.title=document.title.substring(4,document.title.length-4)}};window.onblur=function(){Fe=false};var Ge=false;function Ne(){if(Ge===true){return}Ge=true;if(window.navigator.standalone===true){document.body.classList.add("ios-web-app")}document.documentElement.classList.remove("start-center");fe();Se=new se;var e=window.location.href.substr(0,5)==="http:"?"ws:":"wss:";var n;if(window.location.href.substr(0,5)==="http:"){if(window.location.host!=="127.0.0.1"){n="ws://139.162.160.231/connect"}else{n="ws://127.0.0.1/connect"}}else{n="wss://"+window.location.hostname+"/connect"}xe=new oe(n);Pe=new it;Pe.currentScreen=Pe.screenLoading;window.addEventListener("resize",resize);if(P()>0){document.body.classList.add("internet-explorer")}if(window.navigator.standalone===true){}document.addEventListener("touchstart",function(){},true);t();j();Be();h();if(typeof serverData.user!=="undefined"){var i={};i["facebook"]="FACEBOOK";i["gplus"]="GOOGLE";element.profileName.innerHTML=he.name;element.profileProvider.innerHTML=i[he.provider];element.profileID.innerHTML=he.id;Ae(he.gold);if(he.activeIcon!=="none"){element.profileIcon.src="/i/"+pe[he.activeIcon].filename}else{element.profileIcon.src="/assets/none.svg"}}element.socialBar.classList.remove("hide");if(typeof start!=="undefined"){start()}if(element.cookies!==null){element.cookies.classList.remove("hide")}if(queryArray.length>0&&queryArray[0].length>1){var o=false;gameChannel=queryArray[0];if(queryArray[0]==="main"){if(queryArray.length>1){gameChannel=queryArray[1]}else{o=true}}for(var s=0;s<be.length;s++){if(gameChannel===be[s]){o=true;break}}if(o===false){element.channelInput.value=G(gameChannel);ze();element.aboutToPlayChannel.value=G(gameChannel);Pe.screenInviteFriend.firstTimeEnter=false;Pe.gotoInvited()}else{Ye()}}else{Ye()}(function(e,t,n){var i,o=e.getElementsByTagName(t)[0];if(e.getElementById(n)){return}i=e.createElement(t);i.id=n;i.src="//connect.facebook.net/en_US/sdk.js";o.parentNode.insertBefore(i,o)})(document,"script","facebook-jssdk");element.ingameAd2Hide.addEventListener("click",function(){element.ingameAd2.style.bottom="-150px";element.ingameAd2.style.opacity=0;reloadIngameAdFlag=false})}function Ye(){if(typeof serverData.gotoScreen==="undefined"){Pe.gotoMainMenu()}else{Pe.goto(Pe[serverData.gotoScreen])}}Message=window.Message||{};Message.list=[];Message.hide=function(){document.body.classList.remove("message-visible")};Message.show=function(){document.body.classList.add("message-visible");E()};Message.add=function(e,t){Message.show();Message.list.push({element:e,callback:t});if(Message.list[0].element===e){e.classList.remove("hide");e.classList.add("message-appear");if(typeof t!=="undefined"){t()}E();window.scrollTo(0,0)}else{e.classList.add("hide");e.classList.remove("message-appear")}};Message.addTop=function(e,t,n){if(typeof n==="undefined"){n=false}Message.show();if(n===true&&Message.list.length!==0&&Message.list[0].element===e){return}if(Message.list.length!==0){Message.list[0].element.classList.add("hide");Message.list[0].element.classList.remove("message-appear")}Message.list.unshift({element:e,callback:t});e.classList.remove("hide");e.classList.add("message-appear");if(typeof t!=="undefined"&&t!==null){t()}E();window.scrollTo(0,0)};Message.remove=function(){if(Message.list.length!==0){Message.list[0].element.classList.add("hide");Message.list[0].element.classList.remove("message-appear");Message.list.shift();if(Message.list.length!==0){setTimeout(function(){Message.list[0].element.classList.remove("hide");Message.list[0].element.classList.add("message-appear");if(typeof Message.list[0].callback!=="undefined"){Message.list[0].callback()}E();window.scrollTo(0,0)},1)}}if(Message.list.length===0){Message.hide()}};Message.leave=function(){Message.add(document.getElementById("leave-box"))};Message.gameEndReset=function(){element.gameEndTitlePlayer.classList.add("hide");element.gameEndTitleYou.classList.add("hide");element.gameEndTitleOpponent.classList.add("hide");element.gameEndTitleWon.classList.add("hide");element.gameEndTitleLose.classList.add("hide");element.gameEndTitleDraw.classList.add("hide");element.winSmileyYouContainer.classList.add("hide");element.winSmileyYouContainer.classList.remove("happy-animation");element.winSmileyYouContainer.classList.remove("happy-animation2");element.sunglasses.classList.add("hide");if(element.sunglasses.parentNode!==null){element.sunglasses.parentNode.removeChild(element.sunglasses)}element.winSmileyOpponentContainer.classList.add("hide");element.winSmileyOpponentContainer.classList.remove("happy-animation");element.winSmileyOpponentContainer.classList.remove("happy-animation2");element.winSmileyYou.src="";element.winSmileyOpponent.src=""};Message.youWin=function(){Message.gameEndReset();element.gameEndTitleYou.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-happy.svg";element.winSmileyYouContainer.classList.remove("hide");element.winSmileyYouContainer.classList.add("happy-animation");Message.add(document.getElementById("game-end-box"))};Message.youLose=function(){Message.gameEndReset();element.gameEndTitleYou.classList.remove("hide");element.gameEndTitleLose.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-sad.svg";element.winSmileyYouContainer.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.draw=function(){Message.gameEndReset();element.gameEndTitleDraw.classList.remove("hide");element.winSmileyYouContainer.classList.remove("hide");element.winSmileyOpponentContainer.classList.remove("hide");if(Math.random()>.5){element.winSmileyYou.src="/assets/smiley-what2.svg";element.winSmileyOpponent.src="/assets/smiley-what.svg"}else{element.winSmileyYou.src="/assets/smiley-what.svg";element.winSmileyOpponent.src="/assets/smiley-what2.svg"}Message.add(document.getElementById("game-end-box"))};Message.youWinLocal=function(){Message.gameEndReset();element.gameEndTitlePlayer.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-happy.svg";element.winSmileyYouContainer.classList.remove("hide");element.winSmileyYouContainer.classList.add("happy-animation2");element.winSmileyOpponent.src="/assets/smiley-sad.svg";element.winSmileyOpponentContainer.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.youLoseLocal=function(){Message.gameEndReset();element.gameEndTitlePlayer.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-sad.svg";element.winSmileyYouContainer.classList.remove("hide");element.winSmileyOpponent.src="/assets/smiley-happy.svg";element.winSmileyOpponentContainer.classList.remove("hide");element.winSmileyOpponentContainer.classList.add("happy-animation2");Message.add(document.getElementById("game-end-box"))};Message.sunglassesYou=function(){Message.gameEndReset();element.gameEndTitleYou.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-smirk.svg";element.winSmileyYouContainer.classList.remove("hide");Se.addTimeout(function(){element.winSmileyYouContainer.classList.add("happy-animation")},2e3);element.winSmileyYouContainer.appendChild(element.sunglasses);element.sunglasses.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.sunglassesOpponent=function(){Message.gameEndReset();element.gameEndTitleOpponent.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyOpponent.src="/assets/smiley-smirk.svg";element.winSmileyOpponentContainer.classList.remove("hide");Se.addTimeout(function(){element.winSmileyOpponentContainer.classList.add("happy-animation")},2e3);element.winSmileyOpponentContainer.appendChild(element.sunglasses);element.sunglasses.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.sunglassesYouLocal=function(){Message.gameEndReset();element.gameEndTitlePlayer.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-smirk.svg";element.winSmileyYouContainer.classList.remove("hide");Se.addTimeout(function(){element.winSmileyYouContainer.classList.add("happy-animation2")},2e3);element.winSmileyYouContainer.appendChild(element.sunglasses);element.sunglasses.classList.remove("hide");element.winSmileyOpponent.src="/assets/smiley-sad.svg";element.winSmileyOpponentContainer.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.sunglassesOpponentLocal=function(){Message.gameEndReset();element.gameEndTitlePlayer.classList.remove("hide");element.gameEndTitleWon.classList.remove("hide");element.winSmileyYou.src="/assets/smiley-sad.svg";element.winSmileyYouContainer.classList.remove("hide");element.winSmileyOpponent.src="/assets/smiley-smirk.svg";element.winSmileyOpponentContainer.classList.remove("hide");Se.addTimeout(function(){element.winSmileyOpponentContainer.classList.add("happy-animation2")},2e3);element.winSmileyOpponentContainer.appendChild(element.sunglasses);element.sunglasses.classList.remove("hide");Message.add(document.getElementById("game-end-box"))};Message.funcWin=[];Message.funcLose=[];Message.funcDraw=[];Message.funcWinSpecial=[];Message.funcLoseSpecial=[];Message.funcWin[me.online]=Message.youWin;Message.funcLose[me.online]=Message.youLose;Message.funcDraw[me.online]=Message.draw;Message.funcWinSpecial[me.online]=Message.sunglassesYou;Message.funcLoseSpecial[me.online]=Message.sunglassesOpponent;Message.funcWin[me.local]=Message.youWinLocal;Message.funcLose[me.local]=Message.youLoseLocal;Message.funcDraw[me.local]=Message.draw;Message.funcWinSpecial[me.local]=Message.sunglassesYouLocal;Message.funcLoseSpecial[me.local]=Message.sunglassesOpponentLocal;function Re(e,t){this.name=e;this.element=t}function We(e,t){Re.call(this,e,t)}We.prototype=Object.create(Re.prototype);We.prototype.exit=function(){element.navigation.classList.remove("hide")};function qe(e,t){Re.call(this,e,t);this.firstTimeEnter=true;element.channelInput.addEventListener("input",ze);element.channelInput.addEventListener("change",ze);element.channelInput.addEventListener("keyup",ze);element.channelInput.addEventListener("paste",ze);element.uniqueChannelButton.addEventListener("click",je)}qe.prototype=Object.create(Re.prototype);qe.prototype.enter=function(){element.inviteGoButton.classList.remove("shake-invalid");if(this.firstTimeEnter===true){this.firstTimeEnter=false;je()}};function ze(){var e=G(element.channelInput.value);if(e.length===0){element.shareLinkArea.value="";return}element.shareLinkArea.value=domain+"/"+e}function je(){var e=this;element.channelInput.value="";element.shareLinkArea.value=" ";element.uniqueChannelButton.classList.add("shake-dice");c.post("/api/unique-channel",null,_e)}function _e(e){element.uniqueChannelButton.classList.remove("shake-dice");if(e.length===0){var t="";element.channelInput.value="";element.shareLinkArea.value="Error";return}element.channelInput.value=e;ze()}function Xe(e,t){Re.call(this,e,t);this.reloadAd=true;this.showAd=false}Xe.prototype=Object.create(Re.prototype);Xe.prototype.enter=function(){if(this.reloadAd===true){this.reloadAd=false;V()}};Xe.prototype.exit=function(){element.mainMenuTopAd.classList.add("hide")};function Ve(e,t){element.settingsDarkSkin.addEventListener("change",Ue);element.settingsFallSpeed.addEventListener("change",Ke);element.settingsAiDifficulty.addEventListener("change",Je);Re.call(this,e,t);if(element.embedSettingsWidth===null||element.embedSettingsHeight===null||element.embedSettingsDarkSkin===null){return}element.embedSettingsWidth.addEventListener("input",Qe);element.embedSettingsWidth.addEventListener("change",Qe);element.embedSettingsWidth.addEventListener("keyup",Qe);element.embedSettingsWidth.addEventListener("paste",Qe);element.embedSettingsHeight.addEventListener("input",Qe);element.embedSettingsHeight.addEventListener("change",Qe);element.embedSettingsHeight.addEventListener("keyup",Qe);element.embedSettingsHeight.addEventListener("paste",Qe);element.embedSettingsDarkSkin.addEventListener("change",Qe)}Ve.prototype.enter=function(){if(Se.aiDifficulty!==null){if(element.settingsAiDifficulty.value===""){element.settingsAiDifficulty.removeChild(element.settingsAiDifficulty.getElementsByTagName("option")[0])}element.settingsAiDifficulty.value=Se.aiDifficulty}};function Ue(){if(element.settingsDarkSkin.checked===true){document.body.classList.add("dark-skin")}else{document.body.classList.remove("dark-skin")}}function Je(){if(Se.aiDifficulty===null){element.settingsAiDifficulty.removeChild(element.settingsAiDifficulty.getElementsByTagName("option")[0])}Se.aiDifficulty=element.settingsAiDifficulty.value}function Ke(){switch(element.settingsFallSpeed.value){case"slow":Se.fallSpeed=.11;break;case"normal":Se.fallSpeed=.06;break;case"fast":Se.fallSpeed=.03;break;case"instant":Se.fallSpeed=0;break}}function Qe(){var e="";if(element.embedSettingsDarkSkin.checked===true){e="?skin=dark"}var t=element.embedSettingsWidth.value;if(t!==""&&!isNaN(t)){t='width="'+element.embedSettingsWidth.value+'"'}else{t=""}var n=element.embedSettingsHeight.value;if(n!==""&&!isNaN(n)){n='height="'+element.embedSettingsHeight.value+'"'}else{n=""}element.embedCode.innerHTML="&lt;iframe "+t+" "+n+' src="http://c4arena.com/embed'+e+'" frameborder="0"&gt;&lt;/iframe&gt;'}function Ze(e,t){Re.call(this,e,t);this.nameAddition="";this.showAd=true}Ze.prototype=Object.create(Re.prototype);Ze.prototype.enter=function(){Pe.screenGame.showAd=true;Pe.screenMainMenu.reloadAd=true;if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)){}if(element.settingsLargeBoard.checked===true){element.screens.classList.remove("lock-width")}else{element.screens.classList.add("lock-width")}Se.initialize();U()};Ze.prototype.exit=function(){element.ingameAd.classList.add("hide");element.ingameAd2.classList.add("hide");if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)){}element.screens.classList.add("lock-width");Se.terminate()};Ze.prototype.onConnectionMessage=function(e){Se.onConnectionMessage()};Ze.prototype.onConnectionClose=function(e){Se.onConnectionClose(e)};function $e(e,t){Re.call(this,e,t);Se.channel=null}$e.prototype=Object.create(Re.prototype);$e.prototype.enter=function(){element.findOpponentTitle.classList.remove("hide");element.findOpponentPreloader.classList.remove("hide");element.findOpponentInviteFriendButton.classList.add("hide");element.findOpponentFindOpponentButton.classList.add("hide");element.findOpponentTryAgainButton.classList.add("hide");if(xe.open===false){element.findOpponentTitle.innerHTML="Connecting";xe.connect()}else{element.findOpponentTitle.innerHTML="Connected";et()}};$e.prototype.exit=function(){element.findOpponentTitle.innerHTML=""};$e.prototype.onConnectionOpen=function(){element.findOpponentTitle.innerHTML="Connected"};function et(){var e=element.nameInput.value||"";e=e.substring(0,25);var t=Se.channel;if(t===null){xe.send('{"request":"findOpponent"}')}else{xe.send('{"request":"inviteFriend","channel":"'+t+'", "name":"'+e+'"}')}}$e.prototype.onConnectionMessage=function(e){if(xe.lastMessage.hasOwnProperty("action")){if(xe.lastMessage.action==="ready"){et()}else if(xe.lastMessage.action==="findingOpponent"){if(Se.channel===null){element.findOpponentTitle.innerHTML="Finding opponent";element.findOpponentTitleLink.classList.add("hide")}else{element.findOpponentTitle.innerHTML='Waiting for opponent on channel <div class="wrap">'+Se.channel+"</div>";element.findOpponentTitleLink.classList.remove("hide");element.findOpponentTitleLink.value=domain+"/"+Se.channel}}}if(xe.lastMessage.hasOwnProperty("start")){Pe.gotoGame()}resize()};$e.prototype.onConnectionClose=function(e){if(e.code===ge.idleTimeExceeded){element.findOpponentPreloader.classList.add("hide");if(Se.channel===null){element.findOpponentTitle.innerHTML="Can't find opponent";element.findOpponentInviteFriendButton.classList.remove("hide");element.findOpponentFindOpponentButton.classList.remove("add");element.findOpponentTitleLink.classList.add("hide")}else{element.findOpponentTitle.innerHTML="Opponent didn't come";element.findOpponentTitleLink.value=domain+"/"+Se.channel;element.findOpponentInviteFriendButton.classList.add("hide");element.findOpponentFindOpponentButton.classList.remove("hide");element.findOpponentTitleLink.classList.add("hide")}element.findOpponentTryAgainButton.classList.remove("hide");resize()}else{Message.addTop(element.errorBox,function(){var t="";if(typeof ye[e.code]!=="undefined"){t=ye[e.code]}else if(typeof e.reason!=="undefined"){t=e.reason}if(t!==""){t+="<br>"}element.errorTitle.innerHTML="[Error "+e.code+"]<br>"+t+"Connection has been closed."},true);Pe.back()}};function tt(e,t){Re.call(this,e,t)}tt.prototype=Object.create(Re.prototype);tt.prototype.enter=function(){Le=he.activeIcon};tt.prototype.exit=function(){we=he.activeIcon;if(Le!==we){Ce(he.activeIcon)}};function nt(e){var t=JSON.parse(e);var n=Math.max(t.users.active,t.users.connected);if(n>1){element.playersOnline.innerHTML="~"+n+" players online"}else{element.playersOnline.innerHTML=""}resize()}function it(){this.screenLoading=new We("loading",element.screenLoading);this.screenMainMenu=new Xe("main-menu",element.screenMainMenu);this.screenFindOpponent=new $e("find-opponent",element.screenFindOpponent);this.screenGame=new Ze("game",element.screenGame);this.screenInviteFriend=new qe("invite-friend",element.screenInviteFriend);this.screenInvited=new Re("invited",element.screenInvited);this.screenMore=new Ve("more",element.screenMore);this.screenProfile=new Re("profile",element.screenProfile);this.screenIcons=new tt("icons",element.screenIcons);this.screenBuyGold=new Re("buy-gold",element.screenBuyGold);this.currentScreen}it.prototype.reset=function(){this.currentScreen=null};it.prototype.reload=function(){var e=this.currentScreen;this.reset();this.goto(e)};it.prototype.goto=function(e,t,n){if(element.cookies!==null){element.cookies.style.display="none"}if(typeof n==="undefined"||n===true){element.navigation.classList.remove("hide");element.back.classList.remove("hide");element.leave.classList.add("hide")}else{element.navigation.classList.add("hide")}if(typeof this.currentScreen!=="undefined"&&this.currentScreen!==null){if(typeof this.currentScreen.exit==="function"){this.currentScreen.exit()}this.currentScreen.element.classList.add("hide")}this.currentScreen=e;this.currentScreen.element.classList.remove("hide");if(typeof this.currentScreen.enter==="function"){this.currentScreen.enter()}if(typeof t==="undefined"||t===true){resize()}if(e.name!==null&e.name.length>=0){var i=e.name;if(e===Pe.screenGame){i+="/"+e.nameAddition}ga("set","page","/"+i);ga("send","pageview")}};it.prototype.gotoLoading=function(){this.goto(this.screenLoading)};it.prototype.gotoMainMenu=function(){if(this.screenMainMenu.showAd===true){W("main menu")}c.post("/api/stats",null,nt);element.navigation.classList.add("hide");element.back.classList.add("hide");element.leave.classList.add("hide");this.goto(this.screenMainMenu,true,false);element.navigation.classList.add("hide");if(element.cookies!==null&&element.cookies.classList.contains("hide")===false){element.cookies.style.display="block"}};it.prototype.gotoFindOpponent=function(){Se.channel=null;this.goto(this.screenFindOpponent)};it.prototype.gotoGame=function(){if(Se.channel===null){this.screenGame.nameAddition="online-stranger"}else{this.screenGame.nameAddition="online-friend"}Se.mode=me.online;Se.ai=false;this.goto(this.screenGame);element.back.classList.add("hide");element.leave.classList.remove("hide");if(Fe===false&&document.title.substring(0,3)!=="!!!"){document.title="!!! "+document.title}};it.prototype.gotoGameLocalMultiplayer=function(){this.screenGame.nameAddition="local-multiplayer";Se.mode=me.local;Se.ai=false;this.goto(this.screenGame);element.back.classList.remove("hide");element.leave.classList.add("hide")};it.prototype.gotoGameLocalAI=function(){this.screenGame.nameAddition="local-ai";Se.mode=me.local;Se.ai=true;if(this.currentScreen!==this.screenGame){this.goto(this.screenGame)}else{this.reload()}element.back.classList.remove("hide");element.leave.classList.add("hide")};it.prototype.gotoInviteFriend=function(){this.goto(this.screenInviteFriend)};it.prototype.gotoInvited=function(){this.goto(this.screenInvited)};it.prototype.gotoMore=function(){this.goto(this.screenMore)};it.prototype.gotoIcons=function(){this.goto(this.screenIcons)};it.prototype.gotoProfile=function(){this.goto(this.screenProfile)};it.prototype.gotoBuyGold=function(){this.goto(this.screenBuyGold)};it.prototype.gotoFindOpponentChannel=function(){if(element.shareLinkArea.value.length===0||element.shareLinkArea.value==="Error"){element.inviteGoButton.classList.remove("shake-invalid");void element.inviteGoButton.offsetWidth;element.inviteGoButton.classList.add("shake-invalid");return}Se.channel=G(element.channelInput.value);this.goto(this.screenFindOpponent)};it.prototype.gotoFindOpponentChannelInvited=function(){element.nameInput.value=element.nameInputInvited.value;this.gotoFindOpponentChannel()};it.prototype.back=function(){switch(this.currentScreen){case this.screenFindOpponent:if(Se.channel===null){this.gotoMainMenu()}else{this.gotoInviteFriend()}xe.send('{"request":"stopFinding"}');break;case this.screenGame:if(Se.mode===me.online){if(Se.end===false){Message.leave()}else{this.leave()}}else{this.gotoMainMenu()}break;case this.screenInviteFriend:this.gotoMainMenu();break;case this.screenInvited:this.gotoMainMenu();break;case this.screenMore:this.gotoMainMenu();break;case this.screenProfile:this.gotoMainMenu();break;case this.screenIcons:this.gotoProfile();break;case this.screenBuyGold:this.gotoProfile();break;default:this.gotoMainMenu();break}};it.prototype.rematch=function(){element.rematchButton.classList.add("pointer-events-none");if(Se.leaved===false&&Se.connectionClosed===false){element.rematchTitle.innerHTML="Waiting for response";element.rematchTitle.classList.remove("hide");element.rematchTitle.classList.add("pointer-events-none");xe.send('{"request":"rematch"}')}else if(Se.connectionClosed===true){element.rematchTitle.classList.remove("pointer-events-none");element.rematchTitle.innerHTML="Connection is already closed";element.rematchTitle.classList.remove("hide")}else{element.rematchTitle.classList.remove("pointer-events-none");element.rematchTitle.innerHTML="Opponent leaved";element.rematchTitle.classList.remove("hide")}};it.prototype.playAgain=function(){if(Se.mode===me.online){Pe.gotoFindOpponent()}else{Pe.reload()}};it.prototype.leave=function(){xe.send('{"request":"leave"}');if(Se.channel===null){Pe.gotoMainMenu()}else{Pe.gotoInviteFriend()}};function Re(e,t){this.name=e;this.element=t}function We(e,t){Re.call(this,e,t)}We.prototype=Object.create(Re.prototype);We.prototype.exit=function(){element.navigation.classList.remove("hide")};function qe(e,t){Re.call(this,e,t);this.firstTimeEnter=true;element.channelInput.addEventListener("input",ze);element.channelInput.addEventListener("change",ze);element.channelInput.addEventListener("keyup",ze);element.channelInput.addEventListener("paste",ze);element.uniqueChannelButton.addEventListener("click",je)}qe.prototype=Object.create(Re.prototype);qe.prototype.enter=function(){element.inviteGoButton.classList.remove("shake-invalid");if(this.firstTimeEnter===true){this.firstTimeEnter=false;je()}};function ze(){var e=G(element.channelInput.value);if(e.length===0){element.shareLinkArea.value="";return}element.shareLinkArea.value=domain+"/"+e}function je(){var e=this;element.channelInput.value="";element.shareLinkArea.value=" ";element.uniqueChannelButton.classList.add("shake-dice");c.post("/api/unique-channel",null,_e)}function _e(e){element.uniqueChannelButton.classList.remove("shake-dice");if(e.length===0){var t="";element.channelInput.value="";element.shareLinkArea.value="Error";return}element.channelInput.value=e;ze()}function Xe(e,t){Re.call(this,e,t);this.reloadAd=true;this.showAd=false}Xe.prototype=Object.create(Re.prototype);Xe.prototype.enter=function(){if(this.reloadAd===true){this.reloadAd=false}element.partners.classList.remove("hide")};Xe.prototype.exit=function(){element.mainMenuTopAd.classList.add("hide");element.partners.classList.add("hide")};function Ve(e,t){element.settingsDarkSkin.addEventListener("change",Ue);element.settingsFallSpeed.addEventListener("change",Ke);element.settingsAiDifficulty.addEventListener("change",Je);Re.call(this,e,t);if(element.embedSettingsWidth===null||element.embedSettingsHeight===null||element.embedSettingsDarkSkin===null){return}element.embedSettingsWidth.addEventListener("input",Qe);element.embedSettingsWidth.addEventListener("change",Qe);element.embedSettingsWidth.addEventListener("keyup",Qe);element.embedSettingsWidth.addEventListener("paste",Qe);element.embedSettingsHeight.addEventListener("input",Qe);element.embedSettingsHeight.addEventListener("change",Qe);element.embedSettingsHeight.addEventListener("keyup",Qe);element.embedSettingsHeight.addEventListener("paste",Qe);element.embedSettingsDarkSkin.addEventListener("change",Qe)}Ve.prototype.enter=function(){if(Se.aiDifficulty!==null){if(element.settingsAiDifficulty.value===""){element.settingsAiDifficulty.removeChild(element.settingsAiDifficulty.getElementsByTagName("option")[0])}element.settingsAiDifficulty.value=Se.aiDifficulty}};function Ue(){if(element.settingsDarkSkin.checked===true){document.body.classList.add("dark-skin")}else{document.body.classList.remove("dark-skin")}}function Je(){if(Se.aiDifficulty===null){element.settingsAiDifficulty.removeChild(element.settingsAiDifficulty.getElementsByTagName("option")[0])}Se.aiDifficulty=element.settingsAiDifficulty.value}function Ke(){switch(element.settingsFallSpeed.value){case"slow":Se.fallSpeed=.11;break;case"normal":Se.fallSpeed=.06;break;case"fast":Se.fallSpeed=.03;break;case"instant":Se.fallSpeed=0;break}}function Qe(){var e="";if(element.embedSettingsDarkSkin.checked===true){e="?skin=dark"}var t=element.embedSettingsWidth.value;if(t!==""&&!isNaN(t)){t='width="'+element.embedSettingsWidth.value+'"'}else{t=""}var n=element.embedSettingsHeight.value;if(n!==""&&!isNaN(n)){n='height="'+element.embedSettingsHeight.value+'"'}else{n=""}element.embedCode.innerHTML="&lt;iframe "+t+" "+n+' src="http://c4arena.com/embed'+e+'" frameborder="0"&gt;&lt;/iframe&gt;'}function Ze(e,t){Re.call(this,e,t);this.nameAddition="";this.showAd=true}Ze.prototype=Object.create(Re.prototype);Ze.prototype.enter=function(){Pe.screenGame.showAd=true;Pe.screenMainMenu.reloadAd=true;if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)){}if(element.settingsLargeBoard.checked===true){element.screens.classList.remove("lock-width")}else{element.screens.classList.add("lock-width")}Se.initialize();U()};Ze.prototype.exit=function(){element.ingameAd.classList.add("hide");element.ingameAd2.classList.add("hide");if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)){}element.screens.classList.add("lock-width");Se.terminate()};Ze.prototype.onConnectionMessage=function(e){Se.onConnectionMessage()};Ze.prototype.onConnectionClose=function(e){Se.onConnectionClose(e)};function $e(e,t){Re.call(this,e,t);Se.channel=null}$e.prototype=Object.create(Re.prototype);$e.prototype.enter=function(){element.findOpponentTitle.classList.remove("hide");element.findOpponentPreloader.classList.remove("hide");element.findOpponentInviteFriendButton.classList.add("hide");element.findOpponentFindOpponentButton.classList.add("hide");element.findOpponentTryAgainButton.classList.add("hide");if(xe.open===false){element.findOpponentTitle.innerHTML="Connecting";xe.connect()}else{element.findOpponentTitle.innerHTML="Connected";et()}setTimeout(function(){element.findOpponentAd.innerHTML="";if(Pe.currentScreen===Pe.screenFindOpponent){J()}},250)};$e.prototype.exit=function(){element.findOpponentTitle.innerHTML=""};$e.prototype.onConnectionOpen=function(){element.findOpponentTitle.innerHTML="Connected"};function et(){var e=element.nameInput.value||"";e=e.substring(0,25);var t=Se.channel;if(t===null){xe.send('{"request":"findOpponent"}')}else{xe.send('{"request":"inviteFriend","channel":"'+t+'", "name":"'+e+'"}')}}$e.prototype.onConnectionMessage=function(e){if(xe.lastMessage.hasOwnProperty("action")){if(xe.lastMessage.action==="ready"){et()}else if(xe.lastMessage.action==="findingOpponent"){if(Se.channel===null){element.findOpponentTitle.innerHTML="Finding opponent";element.findOpponentTitleLink.classList.add("hide")}else{element.findOpponentTitle.innerHTML='Waiting for opponent on channel <div class="wrap">'+Se.channel+"</div>";element.findOpponentTitleLink.classList.remove("hide");element.findOpponentTitleLink.value=domain+"/"+Se.channel}}}if(xe.lastMessage.hasOwnProperty("start")){Pe.gotoGame()}resize()};$e.prototype.onConnectionClose=function(e){if(e.code===ge.idleTimeExceeded){element.findOpponentPreloader.classList.add("hide");if(Se.channel===null){element.findOpponentTitle.innerHTML="Can't find opponent";element.findOpponentInviteFriendButton.classList.remove("hide");element.findOpponentFindOpponentButton.classList.remove("add");element.findOpponentTitleLink.classList.add("hide")}else{element.findOpponentTitle.innerHTML="Opponent didn't come";element.findOpponentTitleLink.value=domain+"/"+Se.channel;element.findOpponentInviteFriendButton.classList.add("hide");element.findOpponentFindOpponentButton.classList.remove("hide");element.findOpponentTitleLink.classList.add("hide")}element.findOpponentTryAgainButton.classList.remove("hide");resize()}else{Message.addTop(element.errorBox,function(){var t="";if(typeof ye[e.code]!=="undefined"){t=ye[e.code]}else if(typeof e.reason!=="undefined"){t=e.reason}if(t!==""){t+="<br>"}element.errorTitle.innerHTML="[Error "+e.code+"]<br>"+t+"Connection has been closed."},true);Pe.back()}};function tt(e,t){Re.call(this,e,t)}tt.prototype=Object.create(Re.prototype);tt.prototype.enter=function(){Le=he.activeIcon};tt.prototype.exit=function(){we=he.activeIcon;if(Le!==we){Ce(he.activeIcon)}};function nt(e){var t=JSON.parse(e);var n=Math.max(t.users.active,t.users.connected);if(n>1){element.playersOnline.innerHTML="~"+n+" players online"}else{element.playersOnline.innerHTML=""}resize()}function it(){this.screenLoading=new We("loading",element.screenLoading);this.screenMainMenu=new Xe("main-menu",element.screenMainMenu);this.screenFindOpponent=new $e("find-opponent",element.screenFindOpponent);this.screenGame=new Ze("game",element.screenGame);this.screenInviteFriend=new qe("invite-friend",element.screenInviteFriend);this.screenInvited=new Re("invited",element.screenInvited);this.screenMore=new Ve("more",element.screenMore);this.screenProfile=new Re("profile",element.screenProfile);this.screenIcons=new tt("icons",element.screenIcons);this.screenBuyGold=new Re("buy-gold",element.screenBuyGold);this.currentScreen}it.prototype.reset=function(){this.currentScreen=null};it.prototype.reload=function(){var e=this.currentScreen;this.reset();this.goto(e)};it.prototype.goto=function(e,t,n){if(element.cookies!==null){element.cookies.style.display="none"}if(typeof n==="undefined"||n===true){element.navigation.classList.remove("hide");element.back.classList.remove("hide");element.leave.classList.add("hide")}else{element.navigation.classList.add("hide")}if(typeof this.currentScreen!=="undefined"&&this.currentScreen!==null){if(typeof this.currentScreen.exit==="function"){this.currentScreen.exit()}this.currentScreen.element.classList.add("hide")}this.currentScreen=e;this.currentScreen.element.classList.remove("hide");if(typeof this.currentScreen.enter==="function"){this.currentScreen.enter()}if(typeof t==="undefined"||t===true){resize()}if(e.name!==null&e.name.length>=0){var i=e.name;if(e===Pe.screenGame){i+="/"+e.nameAddition}ga("set","page","/"+i);ga("send","pageview")}};it.prototype.gotoLoading=function(){this.goto(this.screenLoading)};it.prototype.gotoMainMenu=function(){if(this.screenMainMenu.showAd===true){W("main menu")}c.post("/api/stats",null,nt);element.navigation.classList.add("hide");element.back.classList.add("hide");element.leave.classList.add("hide");this.goto(this.screenMainMenu,true,false);element.navigation.classList.add("hide");if(element.cookies!==null&&element.cookies.classList.contains("hide")===false){element.cookies.style.display="block"}};it.prototype.gotoFindOpponent=function(){Se.channel=null;var e=this;l(function(){e.goto(e.screenFindOpponent)})};it.prototype.gotoGame=function(){if(Se.channel===null){this.screenGame.nameAddition="online-stranger"}else{this.screenGame.nameAddition="online-friend"}Se.mode=me.online;Se.ai=false;this.goto(this.screenGame);element.back.classList.add("hide");element.leave.classList.remove("hide");if(Fe===false&&document.title.substring(0,3)!=="!!!"){document.title="!!! "+document.title}};it.prototype.gotoGameLocalMultiplayer=function(){var e=this;l(function(){e.screenGame.nameAddition="local-multiplayer";Se.mode=me.local;Se.ai=false;e.goto(e.screenGame);element.back.classList.remove("hide");element.leave.classList.add("hide")})};it.prototype.gotoGameLocalAI=function(){var e=this;l(function(){e.screenGame.nameAddition="local-ai";Se.mode=me.local;Se.ai=true;if(e.currentScreen!==e.screenGame){e.goto(e.screenGame)}else{e.reload()}element.back.classList.remove("hide");element.leave.classList.add("hide")})};it.prototype.gotoInviteFriend=function(){this.goto(this.screenInviteFriend)};it.prototype.gotoInvited=function(){this.goto(this.screenInvited)};it.prototype.gotoMore=function(){this.goto(this.screenMore)};it.prototype.gotoIcons=function(){this.goto(this.screenIcons)};it.prototype.gotoProfile=function(){this.goto(this.screenProfile)};it.prototype.gotoBuyGold=function(){this.goto(this.screenBuyGold)};it.prototype.gotoFindOpponentChannel=function(){if(element.shareLinkArea.value.length===0||element.shareLinkArea.value==="Error"){element.inviteGoButton.classList.remove("shake-invalid");void element.inviteGoButton.offsetWidth;element.inviteGoButton.classList.add("shake-invalid");return}Se.channel=G(element.channelInput.value);this.goto(this.screenFindOpponent)};it.prototype.gotoFindOpponentChannelInvited=function(){element.nameInput.value=element.nameInputInvited.value;this.gotoFindOpponentChannel()};it.prototype.back=function(){switch(this.currentScreen){case this.screenFindOpponent:if(Se.channel===null){this.gotoMainMenu()}else{this.gotoInviteFriend()}xe.send('{"request":"stopFinding"}');break;case this.screenGame:if(Se.mode===me.online){if(Se.end===false){Message.leave()}else{this.leave()}}else{this.gotoMainMenu()}break;case this.screenInviteFriend:this.gotoMainMenu();break;case this.screenInvited:this.gotoMainMenu();break;case this.screenMore:this.gotoMainMenu();break;case this.screenProfile:this.gotoMainMenu();break;case this.screenIcons:this.gotoProfile();break;case this.screenBuyGold:this.gotoProfile();break;default:this.gotoMainMenu();break}};it.prototype.rematch=function(){element.rematchButton.classList.add("pointer-events-none");if(Se.leaved===false&&Se.connectionClosed===false){element.rematchTitle.innerHTML="Waiting for response";element.rematchTitle.classList.remove("hide");element.rematchTitle.classList.add("pointer-events-none");xe.send('{"request":"rematch"}')}else if(Se.connectionClosed===true){element.rematchTitle.classList.remove("pointer-events-none");element.rematchTitle.innerHTML="Connection is already closed";element.rematchTitle.classList.remove("hide")}else{element.rematchTitle.classList.remove("pointer-events-none");element.rematchTitle.innerHTML="Opponent leaved";element.rematchTitle.classList.remove("hide")}};it.prototype.playAgain=function(){if(Se.mode===me.online){Pe.gotoFindOpponent()}else{l(function(){Pe.reload()})}};it.prototype.leave=function(){xe.send('{"request":"leave"}');if(Se.channel===null){Pe.gotoMainMenu()}else{Pe.gotoInviteFriend()}}})();